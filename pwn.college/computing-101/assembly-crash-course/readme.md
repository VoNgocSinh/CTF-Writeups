# Pwn.college - writeups CTF

- **Challenge:** Assembly Level 1 -> 30
- **Category:** Programming languages
- **Difficulty:** Easy
- **Source**: [pwn.college](https://pwn.college/computing-101/assembly-crash-course/)

**üìùNote:** Xhi ch√†o c√°c b·∫°n! Trong ```writeup``` n√†y m√¨nh s·∫Ω chia s·∫ª l·∫°i h√†nh tr√¨nh h·ªçc v√† l√†m c√°c th·ª≠ th√°ch Assembly t·ª´ level 1 ƒë·∫øn 30. M√¨nh ch·ªçn pwn.college
 l√†m n∆°i b·∫Øt ƒë·∫ßu v√¨ ƒë√¢y l√† m·ªôt kh√≥a h·ªçc r·∫•t tr·ª±c quan, d·ªÖ ti·∫øp c·∫≠n cho ng∆∞·ªùi m·ªõi. Hy v·ªçng writeup n√†y s·∫Ω gi√∫p c√°c b·∫°n m·ªõi b·∫Øt ƒë·∫ßu c√≥ th√™m t√†i li·ªáu tham kh·∫£o v√† c·∫£m th·∫•y Assembly b·ªõt ‚Äúkh√≥ nh·∫±n‚Äù h∆°n. Th√¨ trong challenge n√†y m√¨nh s·∫Ω h·ªçc v√† s·ª≠ d·ª•ng python v√† th∆∞ vi·ªán pwntools ƒë·ªÉ l√†m c√°c th·ª≠ th√°ch ƒë√≥. V√† 1 template m√¨nh s·∫Ω s·ª≠ d·ª•ng h·∫ßu h·∫øt cho to√†n b·ªô c√°c level l√†:
```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    Code here
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

V√† tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu m√¨nh c√≥ 1 v√†i docs v√† video li√™n quan ƒë·∫øn Assembly c√°c b·∫°n c√≥ th·ªÉ ƒë·ªçc th·ª≠ t·∫°i ƒë√¢y:
- [LiveOverflow](https://www.youtube.com/watch?v=iyAyN3GFM7A&list=PLhixgUqwRTjxglIswKp9mpkfPNfHkzyeN&index=1)
- [Comprehensive assembly tutorial](https://github.com/mytechnotalent/Reverse-Engineering-Tutorial)
- [Architecture 1001: x86-64 Assembly](https://ost2.fyi/Arch1001)
- [x86_64 assembly book](https://open.umn.edu/opentextbooks/textbooks/733)
- ...vv

Gi·ªù th√¨ ch√∫ng ta b·∫Øt ƒë·∫ßu nh√© >.<

### Level 1 - set-register
---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i
ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.
- ```rdi = 0x1337```
---
#### L·ªùi gi·∫£i
B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng l·ªánh ```mov``` (move), ƒë·ªÉ g√°n gi√° tr·ªã ```0x1337``` cho thanh ghi ```rdi```.

- ```mov destination, source```

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rdi, 0x1337
"""

output.write(pwn.asm(asm))
print(output.readallS())
```
---

#### Flag
```pwn.college{oKKStzagvDTco-U2z7JeqL9aJ7I.dRTOxwCMxADNwEzW}```

---

### Level 2 - set-multiple-register
---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i
ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.
- ```rax = 0x1337``` <br>
- ```r12 = 0xCAFED00D1337BEEF```<br>
- ```rsp = 0x31337```
---
#### L·ªùi gi·∫£i
B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng l·ªánh ```mov``` (move), ƒë·ªÉ g√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho c√°c thanh ghi:
- mov rax, 0x1337
- mov r12, 0xCAFED00D1337BEEF
- mov rsp, 0x31337

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rax, 0x1337
    mov r12, 0xCAFED00D1337BEEF
    mov rsp, 0x31337
"""

output.write(pwn.asm(asm))
print(output.readallS())
```
---
#### Flag
```pwn.college{84QGDVvZkB175O8V2O8f0fLeUsT.QXwEDOzwCMxADNwEzW}```

---

### Level 3 - add-to-register
---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i
ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.

Ta s·∫Ω ƒë∆∞·ª£c ƒë·∫∑t m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ ng·∫´u nhi√™n tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. ·ªû m·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ta s·∫Ω c·∫ßn th·ª±c hi·ªán c√°c ph√©p to√°n c√≥ c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ch√∫ng ta s·∫Ω ƒë∆∞·ª£c bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p s·∫µn v√† ta c·∫ßn ƒë·∫∑t k·∫øt qu·∫£ ·ªü ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

C√≥ r·∫•t nhi·ªÅu l·ªánh trong x86 cho ph√©p ta th·ª±c hi·ªán t·∫•t c·∫£ c√°c ph√©p to√°n to√°n h·ªçc th√¥ng th∆∞·ªùng tr√™n c√°c thanh ghi v√† b·ªô nh·ªõ.  

ƒê·ªÉ vi·∫øt ng·∫Øn g·ªçn, khi ch√∫ng ta n√≥i `A += B`, n√≥ th·ª±c s·ª± c√≥ nghƒ©a l√† `A = A + B`.
#### ƒê√¢y l√† 1 s·ªë ph√©p to√°n c∆° b·∫£n trong x86:
- `add reg1, reg2` ‚áî `reg1 += reg2`
- `sub reg1, reg2` ‚áî `reg1 -= reg2`
- `imul reg1, reg2` ‚áî `reg1 *= reg2`

L·ªánh `div` ph·ª©c t·∫°p h∆°n, ch√∫ng ta s·∫Ω th·∫£o lu·∫≠n sau.  

L∆∞u √Ω: t·∫•t c·∫£ `regX` c√≥ th·ªÉ ƒë∆∞·ª£c thay th·∫ø b·ªüi m·ªôt h·∫±ng s·ªë ho·∫∑c m·ªôt v·ªã tr√≠ trong b·ªô nh·ªõ.

Nhi·ªám v·ª• c·ªßa b√†i:
- ```Add 0x331337 to rdi```

---

#### L·ªùi gi·∫£i
B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```add``` ƒë∆∞·ª£c cho ·ªü tr√™n, ƒë·ªÉ t√≠nh to√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho thanh ghi ```rdi```:
- `add rdi, 0x331337`

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    add rdi, 0x331337
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{wd0wKMwgM-5ShaBXefwLGguJct2.dVTOxwCMxADNwEzW}```

---

### Level 4 - linear-equation-register

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i
ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.

Ch√∫ng ta s·∫Ω ƒë·∫∑t m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ m·ªôt c√°ch ƒë·ªông tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. M·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã n√†y s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ta s·∫Ω c·∫ßn ph·∫£i th·ª±c hi·ªán m·ªôt s·ªë ph√©p to√°n c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ta s·∫Ω ƒë∆∞·ª£c bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc v√† ta n√™n ƒë·∫∑t k·∫øt qu·∫£ v√†o ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

`L∆∞u √Ω:` C√≥ m·ªôt s·ª± kh√°c bi·ªát quan tr·ªçng gi·ªØa `mul` (nh√¢n kh√¥ng d·∫•u) v√† `imul` (nh√¢n c√≥ d·∫•u) v·ªÅ vi·ªác c√°c thanh ghi n√†o ƒë∆∞·ª£c s·ª≠ d·ª•ng. H√£y xem t√†i li·ªáu c·ªßa c√°c l·ªánh n√†y ƒë·ªÉ th·∫•y s·ª± kh√°c bi·ªát.

Trong tr∆∞·ªùng h·ª£p n√†y, m√¨nh s·∫Ω d√πng `imul`.

Nhi·ªám v·ª• c·ªßa b√†i:
- `f(x) = mx + b`, trong ƒë√≥:  
  - `m = rdi  `
  - `x = rsi`
  - `b = rdx ` 
- ƒê·∫∑t k·∫øt qu·∫£ v√†o `rax`.

---

#### L·ªùi gi·∫£i
B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```add```, ```mov``` v√† ```imul``` ƒë∆∞·ª£c cho ·ªü tr√™n, ƒë·ªÉ t√≠nh to√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho thanh ghi ```rdi```:
- ```mov rax, rdi```
- ```imul rax, rsi```
- ```add rax, rdx```
```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rax, rdi
    imul rax, rsi
    add rax, rdx
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{Ak972rqZI3bTT3lQaA-NewS-9el.dZTOxwCMxADNwEzW}```

---

### Level 5 - integer-division

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i
ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.

Ch√∫ng ta s·∫Ω ƒë·∫∑t m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ m·ªôt c√°ch ƒë·ªông tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. M·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã n√†y s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ta s·∫Ω c·∫ßn ph·∫£i th·ª±c hi·ªán m·ªôt s·ªë ph√©p to√°n c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ta s·∫Ω ƒë∆∞·ª£c bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc v√† ta n√™n ƒë·∫∑t k·∫øt qu·∫£ v√†o ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Ph√©p chia trong `x86` ƒë·∫∑c bi·ªát h∆°n so v·ªõi to√°n h·ªçc b√¨nh th∆∞·ªùng. ·ªû ƒë√¢y g·ªçi l√† ph√©p chia s·ªë nguy√™n, nghƒ©a l√† m·ªçi gi√° tr·ªã ƒë·ªÅu l√† s·ªë nguy√™n.

V√≠ d·ª•: `10 / 3 = 3` trong to√°n s·ªë nguy√™n.  

T·∫°i sao?  
V√¨ 3.33 ƒë∆∞·ª£c l√†m tr√≤n xu·ªëng th√†nh s·ªë nguy√™n.

C√°c l·ªánh li√™n quan trong c·∫•p ƒë·ªô n√†y l√†:  

- `mov rax, reg1`  
- `div reg2`  

`L∆∞u √Ω:` `div` l√† m·ªôt l·ªánh ƒë·∫∑c bi·ªát c√≥ th·ªÉ chia s·ªë b·ªã chia `128-bit` cho s·ªë chia `64-bit`, ƒë·ªìng th·ªùi l∆∞u c·∫£ th∆∞∆°ng v√† s·ªë d∆∞, ch·ªâ d√πng m·ªôt thanh ghi l√†m to√°n h·∫°ng.

L·ªánh `div` ho·∫°t ƒë·ªông nh∆∞ sau (khi chia cho `reg`):  

- `rax = rdx:rax / reg`  
- `rdx = remainder`  

`rdx:rax` nghƒ©a l√† `rdx` s·∫Ω ch·ª©a 64-bit cao c·ªßa s·ªë b·ªã chia 128-bit v√† `rax` ch·ª©a 64-bit th·∫•p c·ªßa s·ªë b·ªã chia 128-bit.

B·∫°n ph·∫£i c·∫©n th·∫≠n v·ªõi nh·ªØng g√¨ n·∫±m trong `rdx` v√† `rax` tr∆∞·ªõc khi g·ªçi `div`.  

Nhi·ªám v·ª• c·ªßa b√†i:

- `speed = distance / time`, trong ƒë√≥:  
  - `distance = rdi ` 
  - `time = rsi  `
  - `speed = rax  `

`L∆∞u √Ω:` V√¨ `distance` lu√¥n n·∫±m trong ph·∫°m vi 64-bit, n√™n `rdx` c·∫ßn ƒë∆∞·ª£c ƒë·∫∑t b·∫±ng 0 tr∆∞·ªõc khi th·ª±c hi·ªán ph√©p chia.

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```div```, ```mov``` ƒë∆∞·ª£c cho ·ªü tr√™n, ƒë·ªÉ t√≠nh to√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho thanh ghi ```rax```:
-   `mov rax, rdi`
-   `div rsi`
```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rax, rdi
    div rsi
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{k590aWudsmdyuMBfYxWEXaX5CFV.ddTOxwCMxADNwEzW}```

---

### Level 6 - modulo-operation

#### T√≥m t·∫Øt ƒë·ªÅ b√†i
ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.

Ch√∫ng ta s·∫Ω ƒë·∫∑t m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ m·ªôt c√°ch ƒë·ªông tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. M·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã n√†y s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ta s·∫Ω c·∫ßn ph·∫£i th·ª±c hi·ªán m·ªôt s·ªë ph√©p to√°n c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ta s·∫Ω ƒë∆∞·ª£c bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc v√† ta n√™n ƒë·∫∑t k·∫øt qu·∫£ v√†o ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Modulo trong assembly l√† m·ªôt kh√°i ni·ªám th√∫ v·ªã kh√°c!  

x86 cho ph√©p b·∫°n l·∫•y ph·∫ßn d∆∞ sau m·ªôt ph√©p chia `div`.  

V√≠ d·ª•: `10 / 3` cho k·∫øt qu·∫£ d∆∞ l√† `1`.  

Ph·∫ßn d∆∞ n√†y ch√≠nh l√† ph√©p modulo, hay c√≤n g·ªçi l√† to√°n t·ª≠ `mod`.  

Trong h·∫ßu h·∫øt c√°c ng√¥n ng·ªØ l·∫≠p tr√¨nh, ch√∫ng ta bi·ªÉu di·ªÖn mod b·∫±ng k√Ω hi·ªáu `%`.

Nhi·ªám v·ª• c·ªßa b√†i:

- `rdi % rsi`
- ƒê·∫∑t k·∫øt qu·∫£ v√†o `rax`.

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```div```, ```mov``` ƒë∆∞·ª£c cho ·ªü tr√™n, ƒë·ªÉ t√≠nh to√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho thanh ghi ```rax```:
-   `mov rax, rdi`
-   `div rsi`
-   `mov rax, rdx`
```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rax, rdi
    div rsi
    mov rax, rdx    #phan du duoc luu o thanh ghi rdx
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{UntmBM38D5Ptt8Zj2WkyZBKqrCx.dhTOxwCMxADNwEzW}```

---

### Level 7 - set-upper-byte

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.

Ch√∫ng ta s·∫Ω ƒë·∫∑t m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ m·ªôt c√°ch ƒë·ªông tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. M·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã n√†y s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ta s·∫Ω c·∫ßn ph·∫£i th·ª±c hi·ªán m·ªôt s·ªë ph√©p to√°n c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ta s·∫Ω ƒë∆∞·ª£c bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc v√† ta n√™n ƒë·∫∑t k·∫øt qu·∫£ v√†o ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

M·ªôt kh√°i ni·ªám th√∫ v·ªã kh√°c trong x86 l√† kh·∫£ nƒÉng truy c·∫≠p ƒë·ªôc l·∫≠p v√†o c√°c byte th·∫•p h∆°n c·ªßa thanh ghi.

M·ªói thanh ghi trong x86_64 c√≥ k√≠ch th∆∞·ªõc 64 bit, v√† trong c√°c c·∫•p ƒë·ªô tr∆∞·ªõc, ch√∫ng ta ƒë√£ truy c·∫≠p to√†n b·ªô thanh ghi b·∫±ng `rax`, `rdi`, ho·∫∑c `rsi`.

Ch√∫ng ta c≈©ng c√≥ th·ªÉ truy c·∫≠p c√°c byte th·∫•p h∆°n c·ªßa m·ªói thanh ghi b·∫±ng c√°c t√™n thanh ghi kh√°c nhau.  

V√≠ d·ª•, 32 bit th·∫•p c·ªßa `rax` c√≥ th·ªÉ ƒë∆∞·ª£c truy c·∫≠p b·∫±ng `eax`, 16 bit th·∫•p b·∫±ng `ax`, v√† 8 bit th·∫•p b·∫±ng `al`.  

```
MSB                                  LSB
+--------------------------------------+
|                 rax                  |
+------------------+-------------------+
                   |        eax        |
                   +---------+---------+
                             |    ax   |
                             +----+----+
                             | ah | al |
                             +----+----+                             
```


Vi·ªác truy c·∫≠p byte th·∫•p c·ªßa thanh ghi √°p d·ª•ng cho h·∫ßu h·∫øt t·∫•t c·∫£ c√°c thanh ghi.  

Nhi·ªám v·ª• c·ªßa b√†i:
- Ch·ªâ v·ªõi m·ªôt l·ªánh `mov`, h√£y ƒë·∫∑t 8 bit cao c·ªßa thanh ghi `ax` th√†nh `0x42`.

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```mov``` ƒë∆∞·ª£c cho ·ªü tr√™n, ƒë·ªÉ t√≠nh to√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho thanh ghi ```ah```:
-  `mov ah, 0x42` 

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov ah, 0x42    #8 bit cao cua ax la ah
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{E34v0I-pMN4AVn6Rb53gNjWOpmw.QXxEDOzwCMxADNwEzW}```

---

### Level 8 - efficient-modulo

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i
ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.

Ch√∫ng ta s·∫Ω ƒë·∫∑t m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ m·ªôt c√°ch ƒë·ªông tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. M·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã n√†y s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ta s·∫Ω c·∫ßn ph·∫£i th·ª±c hi·ªán m·ªôt s·ªë ph√©p to√°n c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ta s·∫Ω ƒë∆∞·ª£c bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc v√† ta n√™n ƒë·∫∑t k·∫øt qu·∫£ v√†o ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Th√¨ ra vi·ªác s·ª≠ d·ª•ng l·ªánh `div` ƒë·ªÉ t√≠nh to√°n ph√©p modulo l√† ch·∫≠m!  

Ch√∫ng ta c√≥ th·ªÉ d√πng m·ªôt m·∫πo to√°n h·ªçc ƒë·ªÉ t·ªëi ∆∞u to√°n t·ª≠ modulo (`%`). Tr√¨nh bi√™n d·ªãch th∆∞·ªùng xuy√™n s·ª≠ d·ª•ng m·∫πo n√†y.  

N·∫øu ch√∫ng ta c√≥ `x % y`, v√† `y` l√† m·ªôt l≈©y th·ª´a c·ªßa 2 (ch·∫≥ng h·∫°n `2^n`), th√¨ k·∫øt qu·∫£ s·∫Ω ch√≠nh l√† `n` bit th·∫•p nh·∫•t c·ªßa `x`.  

V√¨ v·∫≠y, ch√∫ng ta c√≥ th·ªÉ d√πng quy·ªÅn truy c·∫≠p v√†o byte th·∫•p c·ªßa thanh ghi ƒë·ªÉ th·ª±c hi·ªán modulo m·ªôt c√°ch hi·ªáu qu·∫£!  

Ch·ªâ ƒë∆∞·ª£c s·ª≠ d·ª•ng l·ªánh sau:  

- `mov`  

Nhi·ªám v·ª• c·ªßa b√†i:  

- `rax = rdi % 256`  
- `rbx = rsi % 65536`

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```mov``` ƒë∆∞·ª£c cho ·ªü tr√™n, ƒë·ªÉ t√≠nh to√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho thanh ghi `rax` v√† `rbx`:

Ta c√≥:
- `256 = 2^8`
- `65536 = 2^16`

V√¨ th·∫ø, m√¨nh s·∫Ω l·∫•y 8 bit th·∫•p nh·∫•t c·ªßa `rdi` v√† 16 bit th·∫•p nh·∫•t c·ªßa `rsi`.

- `mov al, dil`
- `mov bx, si`

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
   mov al, dil
   mov bx, si
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{UcxGOiYmVzsdZRrWtZhnqEpNRze.dlTOxwCMxADNwEzW}```

---

### Level 9 - byte-extraction

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.

Ch√∫ng ta s·∫Ω ƒë·∫∑t m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ m·ªôt c√°ch ƒë·ªông tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. M·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã n√†y s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ta s·∫Ω c·∫ßn ph·∫£i th·ª±c hi·ªán m·ªôt s·ªë ph√©p to√°n c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ta s·∫Ω ƒë∆∞·ª£c bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc v√† ta n√™n ƒë·∫∑t k·∫øt qu·∫£ v√†o ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi `to√°n t·ª≠ logic v√† bit`. ƒêi·ªÅu n√†y s·∫Ω li√™n quan nhi·ªÅu ƒë·∫øn vi·ªác t∆∞∆°ng t√°c tr·ª±c ti·∫øp v·ªõi c√°c bit ƒë∆∞·ª£c l∆∞u trong thanh ghi ho·∫∑c v·ªã tr√≠ b·ªô nh·ªõ. B·∫°n c≈©ng s·∫Ω c·∫ßn s·ª≠ d·ª•ng c√°c l·ªánh logic trong x86: `and`, `or`, `not`, `xor`.

`D·ªãch chuy·ªÉn bit` trong assembly l√† m·ªôt kh√°i ni·ªám th√∫ v·ªã kh√°c!  

x86 cho ph√©p b·∫°n "d·ªãch chuy·ªÉn" c√°c bit trong m·ªôt thanh ghi.  

V√≠ d·ª•: `al`, t·ª©c l√† 8 bit th·∫•p nh·∫•t (least significant 8 bits) c·ªßa `rax`.  

Gi·∫£ s·ª≠ gi√° tr·ªã trong `al` l√†:  
- `rax = 10001010`


N·∫øu ch√∫ng ta d·ªãch sang tr√°i 1 l·∫ßn b·∫±ng l·ªánh `shl`:  
- `shl al, 1`

Gi√° tr·ªã m·ªõi s·∫Ω l√†:  
- `al = 00010100`


T·∫•t c·∫£ c√°c bit ƒë∆∞·ª£c d·ªãch sang tr√°i, v√† bit cao nh·∫•t (most significant bit) s·∫Ω r∆°i ra, trong khi m·ªôt bit 0 m·ªõi ƒë∆∞·ª£c th√™m v√†o b√™n ph·∫£i.  

B·∫°n c√≥ th·ªÉ d√πng thao t√°c n√†y ƒë·ªÉ l√†m nh·ªØng ƒëi·ªÅu ƒë·∫∑c bi·ªát v·ªõi c√°c bit m√† b·∫°n quan t√¢m.  

D·ªãch bit c√≤n c√≥ t√°c d·ª•ng ph·ª• h·ªØu √≠ch: th·ª±c hi·ªán nh√¢n nhanh (√ó2) ho·∫∑c chia nhanh (√∑2), v√† c√≥ th·ªÉ d√πng ƒë·ªÉ t√≠nh modulo.  

C√°c l·ªánh quan tr·ªçng:

- `shl reg1, reg2` ‚áî D·ªãch tr√°i `reg1` theo s·ªë l·∫ßn trong `reg2`.  
- `shr reg1, reg2` ‚áî D·ªãch ph·∫£i `reg1` theo s·ªë l·∫ßn trong `reg2`.  

L∆∞u √Ω: `reg2` c√≥ th·ªÉ l√† h·∫±ng s·ªë ho·∫∑c v·ªã tr√≠ b·ªô nh·ªõ.  

Khi n√≥i v·ªÅ `significant bit` ho·∫∑c `least significant byte`, √Ω nghƒ©a l√†:  

- `Least significant bit/byte` mang gi√° tr·ªã nh·ªè nh·∫•t (v·ªã tr√≠ "th·∫•p nh·∫•t"). Khi b·∫°n thay ƒë·ªïi bit "th·∫•p nh·∫•t" ho·∫∑c "b√™n ph·∫£i nh·∫•t", gi√° tr·ªã ch·ªâ thay ƒë·ªïi 1 ƒë∆°n v·ªã.  
- `Most significant bit/byte` mang gi√° tr·ªã l·ªõn nh·∫•t (v·ªã tr√≠ "cao nh·∫•t").  

Ch·ªâ ƒë∆∞·ª£c s·ª≠ d·ª•ng c√°c l·ªánh sau:  
- `mov`, `shr`, `shl`

Nhi·ªám v·ª• c·ªßa b√†i:

- H√£y th·ª±c hi·ªán: ƒê·∫∑t `rax` b·∫±ng byte th·∫•p th·ª© 5 c·ªßa `rdi`.  

V√≠ d·ª•:
- `rdi = | B7 | B6 | B5 | B4 | B3 | B2 | B1 | B0 |`
- Set `rax` to the value of `B4`

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```mov```, ```shr``` v√† ```shl``` ƒë∆∞·ª£c cho ·ªü tr√™n ƒë·ªÉ t√≠nh to√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho thanh ghi `rax`:
-  ```shr rdi, 32```
-  `mov rax, 0`
-  `mov al, dil`

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
   shr rdi, 32  #dich sang phai 4 byte = 32 bit
   mov rax, 0
   mov al, dil
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{w-kROQ6JPZk10q1XBo_dfR7Wocv.dBDMywCMxADNwEzW}```

---

### Level 10 - bitwise-and

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.

Ch√∫ng ta s·∫Ω ƒë·∫∑t m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ m·ªôt c√°ch ƒë·ªông tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. M·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã n√†y s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ta s·∫Ω c·∫ßn ph·∫£i th·ª±c hi·ªán m·ªôt s·ªë ph√©p to√°n c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ta s·∫Ω ƒë∆∞·ª£c bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc v√† ta n√™n ƒë·∫∑t k·∫øt qu·∫£ v√†o ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi `to√°n t·ª≠ logic v√† bit`. ƒêi·ªÅu n√†y s·∫Ω li√™n quan nhi·ªÅu ƒë·∫øn vi·ªác t∆∞∆°ng t√°c tr·ª±c ti·∫øp v·ªõi c√°c bit ƒë∆∞·ª£c l∆∞u trong thanh ghi ho·∫∑c v·ªã tr√≠ b·ªô nh·ªõ. B·∫°n c≈©ng s·∫Ω c·∫ßn s·ª≠ d·ª•ng c√°c l·ªánh logic trong x86: `and`, `or`, `not`, `xor`.

`Logic bitwise trong assembly` l√† m·ªôt kh√°i ni·ªám th√∫ v·ªã kh√°c!  
x86 cho ph√©p b·∫°n th·ª±c hi·ªán c√°c ph√©p to√°n logic t·ª´ng bit tr√™n c√°c thanh ghi.  

V√≠ d·ª•, gi·∫£ s·ª≠ thanh ghi ch·ªâ l∆∞u 8 bit:  

- `rax = 10101010`  
- `rbx = 00110011`  

N·∫øu ch√∫ng ta th·ª±c hi·ªán ph√©p `AND` t·ª´ng bit gi·ªØa `rax` v√† `rbx` b·∫±ng l·ªánh `and rax, rbx`, k·∫øt qu·∫£ s·∫Ω ƒë∆∞·ª£c t√≠nh b·∫±ng c√°ch AND t·ª´ng c·∫∑p bit m·ªôt v·ªõi nhau.  

V√≠ d·ª• t·ª´ tr√°i sang ph·∫£i:  

- `1 AND 0 = 0`  
- `0 AND 0 = 0`  
- `1 AND 1 = 1`  
- `0 AND 1 = 0`  
- ...  

K·∫øt h·ª£p t·∫•t c·∫£ k·∫øt qu·∫£, ta ƒë∆∞·ª£c:  
- `rax = 00100010`

B·∫£ng ch√¢n tr·ªã tham kh·∫£o:

**AND**

```
| A | B | X |
|---|---|---|
| 0 | 0 | 0 |
| 0 | 1 | 0 |
| 1 | 0 | 0 |
| 1 | 1 | 1 |
```

**OR**

```
| A | B | X |
|---|---|---|
| 0 | 0 | 0 |
| 0 | 1 | 1 |
| 1 | 0 | 1 |
| 1 | 1 | 1 |
```


**XOR**

```
| A | B | X |
|---|---|---|
| 0 | 0 | 0 |
| 0 | 1 | 1 |
| 1 | 0 | 1 |
| 1 | 1 | 0 |
```

Kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng c√°c l·ªánh sau: `mov`, `xchg`.  

Nhi·ªám v·ª• c·ªßa b√†i:

- ƒê·∫∑t `rax` b·∫±ng gi√° tr·ªã c·ªßa `(rdi AND rsi)`.  

`L∆∞u √Ω:` `rax` ban ƒë·∫ßu s·∫Ω c√≥ t·∫•t c·∫£ bit = 1. N·∫øu kh√¥ng, th√¨ c·∫•p ƒë·ªô n√†y s·∫Ω kh√≥ h∆°n nhi·ªÅu!


--- 

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng ph√©p to√°n ```and``` ƒë∆∞·ª£c cho ·ªü tr√™n ƒë·ªÉ t√≠nh to√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho thanh ghi `rax`:
-  `and rax, rdi`
-  `and rax, rsi`
```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
   and rax, rdi   #tuong tu nhu gan rax = rdi vi hien tai tat cac biet cua rax deu bat
   and rax, rsi
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{EYNEn4Q0ZT_DCYkvsXmNA-4vuXl.dFDMywCMxADNwEzW}```

---

### Level 11 - check-even

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.

Ch√∫ng ta s·∫Ω ƒë·∫∑t m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ m·ªôt c√°ch ƒë·ªông tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. M·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã n√†y s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ta s·∫Ω c·∫ßn ph·∫£i th·ª±c hi·ªán m·ªôt s·ªë ph√©p to√°n c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ta s·∫Ω ƒë∆∞·ª£c bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc v√† ta n√™n ƒë·∫∑t k·∫øt qu·∫£ v√†o ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi `to√°n t·ª≠ logic v√† bit`. ƒêi·ªÅu n√†y s·∫Ω li√™n quan nhi·ªÅu ƒë·∫øn vi·ªác t∆∞∆°ng t√°c tr·ª±c ti·∫øp v·ªõi c√°c bit ƒë∆∞·ª£c l∆∞u trong thanh ghi ho·∫∑c v·ªã tr√≠ b·ªô nh·ªõ. B·∫°n c≈©ng s·∫Ω c·∫ßn s·ª≠ d·ª•ng c√°c l·ªánh logic trong x86: `and`, `or`, `not`, `xor`.

`Logic bitwise trong assembly` l√† m·ªôt kh√°i ni·ªám th√∫ v·ªã kh√°c!  
x86 cho ph√©p b·∫°n th·ª±c hi·ªán c√°c ph√©p to√°n logic t·ª´ng bit tr√™n c√°c thanh ghi.  

Ch·ªâ ƒë∆∞·ª£c s·ª≠ d·ª•ng c√°c to√°n t·ª≠ sau:
- and
- or
- xor

Nhi·ªám v·ª• c·ªßa b√†i:

    if x is even then
      y = 1
    else
      y = 0

    trong ƒë√≥:
    - x = rdi
    - y = rax

--- 

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```and```, ```or```, ```xor``` ƒë∆∞·ª£c cho ·ªü tr√™n ƒë·ªÉ t√≠nh to√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho thanh ghi `rax`:
-   and rdi, 0x1
-   and rax, 0  
-   or rax, 1
-   xor rax, rdi
```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    and rdi, 0x1
    and rax, 0  
    or rax, 1
    xor rax, rdi
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{EewjQFGPUt2YchIAoHKMHduGOTg.dJDMywCMxADNwEzW}```

---

### Level 12 - memory-read

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

ƒê·ªëi v·ªõi level n√†y, ch√∫ng ta s·∫Ω ph·∫£i l√†m vi·ªác v·ªõi ```thanh ghi``` (register). Ta s·∫Ω ƒë∆∞·ª£c s·ª≠a ƒë·ªïi gi√° tr·ªã c·ªßa c√°c ```thanh ghi```.

Ch√∫ng ta s·∫Ω ƒë·∫∑t m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ m·ªôt c√°ch ƒë·ªông tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. M·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã n√†y s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ta s·∫Ω c·∫ßn ph·∫£i th·ª±c hi·ªán m·ªôt s·ªë ph√©p to√°n c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ta s·∫Ω ƒë∆∞·ª£c bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc v√† ta n√™n ƒë·∫∑t k·∫øt qu·∫£ v√†o ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi `memory`. ƒêi·ªÅu n√†y s·∫Ω y√™u c·∫ßu b·∫°n s·∫Ω ƒë·ªçc v√† ghi d·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u trong `memory`. Tuy nhi√™n n·∫øu b·∫°n c√≥ h∆°i b·ªëi r·ªëi, h√£y nh√¨n v√†o ƒë·ªãa ch·ªâ tuy·∫øn t√≠nh (linear addressing). B·∫°n c≈©ng c√≥ th·ªÉ ƒë∆∞·ª£c y√™u c·∫ßu h·ªßy b·ªè tham chi·∫øu nhi·ªÅu l·∫ßn ƒë·∫øn nh·ªØng th·ª© ch√∫ng t√¥i l∆∞u v√†o b·ªô nh·ªõ ƒë·ªÉ b·∫°n s·ª≠ d·ª•ng.

Cho ƒë·∫øn b√¢y gi·ªù, b·∫°n ƒë√£ l√†m vi·ªác v·ªõi thanh ghi nh∆∞ c√°ch ƒë·ªÉ l∆∞u m·ªçi th·ª©, v·ªÅ c∆° b·∫£n l√† nh∆∞ c√°c bi·∫øn s·ªë 'x' nh∆∞ trong to√°n h·ªçc.

Tuy nhi√™n, ch√∫ng ta c≈©ng c√≥ th·ªÉ l∆∞u c√°c bytes v√†o trong `memory`.

Nh·ªõ l·∫°i r·∫±ng `memory` c√≥ th·ªÉ ƒë∆∞·ª£c gi·∫£i quy·∫øt, v√† m·ªói ƒë·ªãa ch·ªâ n√≥ l∆∞u 1 gi√° tr·ªã g√¨ ƒë√≥ t·∫°i ƒë·ªãa ch·ªâ ƒë√≥. L∆∞u √Ω r·∫±ng ƒëi·ªÅu n√†y t∆∞∆°ng t·ª± nh∆∞ c√°c ƒë·ªãa ch·ªâ trong ƒë·ªùi s·ªëng.

V√≠ d·ª• nh∆∞: ƒë·ªãa ch·ªâ `699 S Mill Ave, Tempe, AZ 85281` l√† ƒë·ªãa ch·ªâ tr√™n b·∫£n ƒë·ªì c·ªßa `ASU Brickyard`. Ch√∫ng ta c≈©ng g·ªçi n√≥ l√† 1 ƒëi·ªÉm t·ªõi `ASU Brickyard`. Ch√∫ng ta c√≥ th·ªÉ bi·ªÉu di·ªÖn n√≥ nh∆∞ sau:

    ['699 S Mill Ave, Tempe, AZ 85281'] = 'ASU Brickyard'

ƒê·ªãa ch·ªâ l√† ƒë·∫∑c bi·ªát b·ªüi v√¨ n√≥ l√† duy nh·∫•t. Nh∆∞ng ƒëi·ªÅu ƒë√≥ c≈©ng kh√¥ng c√≥ nghƒ©a l√† c√°c ƒë·ªãa ch·ªâ kh√°c kh√¥ng c√≥ c√πng 1 data. (Nh∆∞ ki·ªÉu 1 ng∆∞·ªùi c√≥ nhi·ªÅu ng√¥i nh√†).

Memory c≈©ng gi·ªëng y h·ªát nh∆∞ v·∫≠y.

V√≠ d·ª• nh∆∞: ƒë·ªãa ch·ªâ trong memory, n∆°i m√† code c·ªßa b·∫°n ƒë∆∞·ª£c l∆∞u ·ªü ```0x400000```. <br>
Trong `x86`, ch√∫ng ta c√≥ th·ªÉ truy c·∫≠p v√†o ƒë·ªãa ch·ªâ c·ªßa memory, g·ªçi l√† h·ªßy tham chi·∫øu, gi·ªëng nh∆∞:

    mov rax, [some_address]        <=>     Moves the thing at 'some_address' into rax

ƒêi·ªÅu n√†y c≈©ng ho·∫°t ƒë·ªông v·ªõi nh·ªØng th·ª© ƒë∆∞·ª£c l∆∞u trong c√°c thanh ghi:

    mov rax, [rdi]         <=>     Moves the thing stored at the address of what rdi holds to rax

T∆∞∆°ng t∆∞, ƒëi·ªÅu n√†y c≈©ng ho·∫°t ƒë·ªông ƒë·ªÉ ghi v√†o memory:

    mov [rax], rdi         <=>     Moves rdi to the address of what rax holds.

V√¨ v√¢y, n·∫øu ```rax``` l√† `0xdeadbeef`, th√¨ `rdi` s·∫Ω l∆∞u gi√° tr·ªã t·∫°i ƒë·ªãa ch·ªâ `0xdeadbeef`:

    [0xdeadbeef] = rdi

L∆∞u √Ω: Memory l√† tuy·∫øn t√≠nh, v√† trong x86_64, n√≥ s·∫Ω ƒë∆∞·ª£c ƒë√°nh d·∫•u t·ª´ 0 t·ªõi 0xffffffffffffffff (Ye, r·∫•t l·ªõn)

Nhi·ªám v·ª• c·ªßa b√†i:
- ƒê·∫∑t gi√° tr·ªã ƒë∆∞·ª£c l∆∞u ·ªü 0x404000 v√†o trong thanh ghi `rax`. L√†m cho gi√° tr·ªã ƒë∆∞·ª£c l∆∞u trong thanh ghi `rax` l√† gi√° tr·ªã ƒë∆∞·ª£c l∆∞u ·ªü 0x404000.

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```mov``` ƒë·ªÉ g√°n gi√° tr·ªã ƒë∆∞·ª£c l∆∞u t·∫°i ƒë·ªãa ch·ªâ `0x404000` cho thanh ghi `rax`:
- mov rax, [0x404000]

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rax, [0x404000]
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{U9ghurLUvBHkvHZwkbOLTVSNVwB.QXyEDOzwCMxADNwEzW}```

---

### Level 13 - memory-write

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

ƒê·ªëi v·ªõi c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi menory. ƒêi·ªÅu s·∫Ω s·∫Ω y√™u c·∫ßu b·∫°n ƒë·ªçc v√† ghi d·ªØ li·ªáu tuy·∫øn t√≠nh trong memory. N·∫øu b·∫°n c√≤n b·ªëi r·ªëi, h√£y th·ª≠ nh√¨n v√†o ƒë·ªãa ch·ªâ tuy·∫øn t√≠nh. B·∫°n c≈©ng c√≥ th·ªÉ y√™u c·∫ßu h·ªßy tham chi·∫øu nhi·ªÅu l·∫ßn ƒë·∫øn nh·ªØng th·ª© ch√∫ng t√¥i l∆∞u v√†o b·ªô nh·ªõ ƒë·ªÉ b·∫°n s·ª≠ d·ª•ng.

Nhi·ªám v·ª• c·ªßa b√†i:

    ƒê·∫∑t gi√° tr·ªã ƒë∆∞·ª£c l∆∞u ·ªü `rax` v√†o ƒë·ªãa ch·ªâ `0x404000`

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```mov``` ƒë·ªÉ g√°n gi√° tr·ªã ƒë∆∞·ª£c l∆∞u t·∫°i thanh ghi `rax` cho ƒë·ªãa ch·ªâ `0x404000`:
- `mov [0x404000], rax`

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov [0x404000], rax
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{c1FyJ-As1E4rlyCi-VxBMdJiF2p.QXzEDOzwCMxADNwEzW}```

---

### Level 14 - memory-increment

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

ƒê·ªëi v·ªõi c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi menory. ƒêi·ªÅu s·∫Ω s·∫Ω y√™u c·∫ßu b·∫°n ƒë·ªçc v√† ghi d·ªØ li·ªáu tuy·∫øn t√≠nh trong memory. N·∫øu b·∫°n c√≤n b·ªëi r·ªëi, h√£y th·ª≠ nh√¨n v√†o ƒë·ªãa ch·ªâ tuy·∫øn t√≠nh. B·∫°n c≈©ng c√≥ th·ªÉ y√™u c·∫ßu h·ªßy tham chi·∫øu nhi·ªÅu l·∫ßn ƒë·∫øn nh·ªØng th·ª© ch√∫ng t√¥i l∆∞u v√†o b·ªô nh·ªõ ƒë·ªÉ b·∫°n s·ª≠ d·ª•ng.

Nhi·ªám v·ª• c·ªßa b√†i:
- ƒê·∫∑t gi√° tr·ªã ƒë∆∞·ª£c l∆∞u ·ªü ƒë·ªãa ch·ªâ `0x404000` v√†o thanh ghi `rax`.
- TƒÉng gi√° tr·ªã ƒë∆∞·ª£c l∆∞u ·ªü ƒë·ªãa ch·ªâ `0x404000` l√™n `0x1337`.

Ch·∫Øc ch·∫Øn r·∫±ng gi√° tr·ªã ƒë∆∞·ª£c l∆∞u ·ªü thanh ghi `rax` l√† gi√° tr·ªã ƒë∆∞·ª£c l∆∞u t·∫°i ƒë·ªãa ch·ªâ `0x404000` v√† [`0x404000`] b√¢y gi·ªù s·∫Ω tƒÉng l√™n.

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```mov``` v√† ```add``` ƒë·ªÉ g√°n gi√° tr·ªã ƒë∆∞·ª£c l∆∞u t·∫°i thanh ghi `rax`, v√† tƒÉng gi√° tr·ªã ƒë∆∞·ª£c l∆∞u t·∫°i ƒë·ªãa ch·ªâ `0x404000` l√™n `0x1337`:
- `mov rax, [0x404000]`
- `mov rbx, 0x1337`
- `add [0x404000], rbx`

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rax, [0x404000]
    mov rbx, 0x1337
    add [0x404000], rbx
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{I6PRTUgXJsA_KPGSKlKeupdhq_x.dNDMywCMxADNwEzW}```

---

### Level 15 - byte-access

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

ƒê·ªëi v·ªõi c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi menory. ƒêi·ªÅu s·∫Ω s·∫Ω y√™u c·∫ßu b·∫°n ƒë·ªçc v√† ghi d·ªØ li·ªáu tuy·∫øn t√≠nh trong memory. N·∫øu b·∫°n c√≤n b·ªëi r·ªëi, h√£y th·ª≠ nh√¨n v√†o ƒë·ªãa ch·ªâ tuy·∫øn t√≠nh. B·∫°n c≈©ng c√≥ th·ªÉ y√™u c·∫ßu h·ªßy tham chi·∫øu nhi·ªÅu l·∫ßn ƒë·∫øn nh·ªØng th·ª© ch√∫ng t√¥i l∆∞u v√†o b·ªô nh·ªõ ƒë·ªÉ b·∫°n s·ª≠ d·ª•ng.

Nh·ªõ l·∫°i r·∫±ng thanh ghi trong `x86_64` c√≥ k√≠ch th∆∞·ªõc l√† 64 bits, nghƒ©a l√† ta c√≥ th·ªÉ l∆∞u t·ªõi 64 bits data. T∆∞∆°ng t·ª±, m·ªói v√πng nh·ªõ c√≥ th·ªÉ truy xu·∫•t t·ªõi gi√° tr·ªã 64-bit. Ch√∫ng ta c√≥ th·ªÉ g·ªçi 1 gi√° tr·ªã c√≥ 64 bits (8 bytes) l√† 1 quad word.

D∆∞·ªõi ƒë√¢y l√† b·∫£ng ph√¢n t√≠ch v·ªÅ t√™n c·ªßa c√°c ki·ªÉu d·ªØ li·ªáu trong memory:
- Quad Word = 8 Bytes = 64 bits
- Double Word = 4 bytes = 32 bits
- Word = 2 bytes = 16 bits
- Byte = 1 byte = 8 bits

Trong x86_64, b·∫°n c√≥ th·ªÉ truy c·∫≠p v√†o t·ª´ng k√≠ch th∆∞·ªõc n√†y khi h·ªßy tham chi·∫øu 1 ƒë·ªãa ch·ªâ, n√≥ ch·ªâ gi·ªëng nh∆∞ s·ª≠ d·ª•ng thanh ghi l·ªõn h∆°n ho·∫∑c nh·ªè h∆°n truy c·∫≠p:
- `mov al, [address]`  <=> truy·ªÅn gi√° tr·ªã c√≥ k√≠ch th·ª©c l√† `byte` t·ª´ address sang `rax`
- `mov ax, [address]`  <=> truy·ªÅn gi√° tr·ªã c√≥ k√≠ch th·ª©c l√† `word` t·ª´ address sang `rax`
- `mov eax, [address]`  <=> truy·ªÅn gi√° tr·ªã c√≥ k√≠ch th·ª©c l√† `double word` t·ª´ address sang `rax`
- `mov rax, [address]`  <=> truy·ªÅn gi√° tr·ªã c√≥ k√≠ch th·ª©c l√† `quad word` t·ª´ address sang `rax`

Nh·ªõ r·∫±ng, truy·ªÅn gi√° tr·ªã t·ªõi thanh ghi `al` kh√¥ng ph·∫£i l√† x√≥a to√†n b·ªô c√°c byte ·ªü tr√™n.

Nhi·ªám v·ª• c·ªßa b√†i:
- ƒê·∫∑t gi√° tr·ªã ·ªü thanh ghi `rax` th√†nh `0x404000`.

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```mov``` ƒë·ªÉ g√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho thanh ghi `rax`:
- `mov al [0x404000]`

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov al, [0x404000]
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{0HZTrwlu4QC8lzXhI3MEM4vLoZL.QX0EDOzwCMxADNwEzW}```

---

### Level 16 - memory-size-access

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

ƒê·ªëi v·ªõi c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi menory. ƒêi·ªÅu s·∫Ω s·∫Ω y√™u c·∫ßu b·∫°n ƒë·ªçc v√† ghi d·ªØ li·ªáu tuy·∫øn t√≠nh trong memory. N·∫øu b·∫°n c√≤n b·ªëi r·ªëi, h√£y th·ª≠ nh√¨n v√†o ƒë·ªãa ch·ªâ tuy·∫øn t√≠nh. B·∫°n c≈©ng c√≥ th·ªÉ y√™u c·∫ßu h·ªßy tham chi·∫øu nhi·ªÅu l·∫ßn ƒë·∫øn nh·ªØng th·ª© ch√∫ng t√¥i l∆∞u v√†o b·ªô nh·ªõ ƒë·ªÉ b·∫°n s·ª≠ d·ª•ng.

Nh·ªõ l·∫°i r·∫±ng thanh ghi trong `x86_64` c√≥ k√≠ch th∆∞·ªõc l√† 64 bits, nghƒ©a l√† ta c√≥ th·ªÉ l∆∞u t·ªõi 64 bits data. T∆∞∆°ng t·ª±, m·ªói v√πng nh·ªõ c√≥ th·ªÉ truy xu·∫•t t·ªõi gi√° tr·ªã 64-bit. Ch√∫ng ta c√≥ th·ªÉ g·ªçi 1 gi√° tr·ªã c√≥ 64 bits (8 bytes) l√† 1 quad word.

D∆∞·ªõi ƒë√¢y l√† b·∫£ng ph√¢n t√≠ch v·ªÅ t√™n c·ªßa c√°c ki·ªÉu d·ªØ li·ªáu trong memory:
- Quad Word = 8 Bytes = 64 bits
- Double Word = 4 bytes = 32 bits
- Word = 2 bytes = 16 bits
- Byte = 1 byte = 8 bits

Trong x86_64, b·∫°n c√≥ th·ªÉ truy c·∫≠p v√†o t·ª´ng k√≠ch th∆∞·ªõc n√†y khi h·ªßy tham chi·∫øu 1 ƒë·ªãa ch·ªâ, n√≥ ch·ªâ gi·ªëng nh∆∞ s·ª≠ d·ª•ng thanh ghi l·ªõn h∆°n ho·∫∑c nh·ªè h∆°n truy c·∫≠p:
- `mov al, [address]`  <=> truy·ªÅn gi√° tr·ªã c√≥ k√≠ch th·ª©c l√† `byte` t·ª´ address sang `rax`
- `mov ax, [address]`  <=> truy·ªÅn gi√° tr·ªã c√≥ k√≠ch th·ª©c l√† `word` t·ª´ address sang `rax`
- `mov eax, [address]`  <=> truy·ªÅn gi√° tr·ªã c√≥ k√≠ch th·ª©c l√† `double word` t·ª´ address sang `rax`
- `mov rax, [address]`  <=> truy·ªÅn gi√° tr·ªã c√≥ k√≠ch th·ª©c l√† `quad word` t·ª´ address sang `rax`

Nhi·ªám v·ª• c·ªßa b√†i:
- Truy·ªÅn v√†o `rax` gi√° tr·ªã d·∫°ng `byte` t·∫°i ƒë·ªãa ch·ªâ `0x404000`
- Truy·ªÅn v√†o `rbx` gi√° tr·ªã d·∫°ng `word` t·∫°i ƒë·ªãa ch·ªâ `0x404000`
- Truy·ªÅn v√†o `rcx` gi√° tr·ªã d·∫°ng `double word` t·∫°i ƒë·ªãa ch·ªâ `0x404000`
- Truy·ªÅn v√†o `rdx` gi√° tr·ªã d·∫°ng `quad word` t·∫°i ƒë·ªãa ch·ªâ `0x404000`

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c ph√©p to√°n ```mov``` ƒë·ªÉ g√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho c√°c thanh ghi `rax`, `rbx`, `rcx` v√† `rdx`:
-    `mov al, [0x404000]`
-    `mov bx, [0x404000]`
-    `mov ecx, [0x404000]`
-    `mov rdx, [0x404000]`
```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov al, [0x404000]
    mov bx, [0x404000]
    mov ecx, [0x404000]
    mov rdx, [0x404000]
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{MLqkK8FKzqv1OZtK2Lwo86mMu6n.dRDMywCMxADNwEzW}```

---

### Level 17 - little-endian-write

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

ƒê·ªëi v·ªõi c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi menory. ƒêi·ªÅu s·∫Ω s·∫Ω y√™u c·∫ßu b·∫°n ƒë·ªçc v√† ghi d·ªØ li·ªáu tuy·∫øn t√≠nh trong memory. N·∫øu b·∫°n c√≤n b·ªëi r·ªëi, h√£y th·ª≠ nh√¨n v√†o ƒë·ªãa ch·ªâ tuy·∫øn t√≠nh. B·∫°n c≈©ng c√≥ th·ªÉ y√™u c·∫ßu h·ªßy tham chi·∫øu nhi·ªÅu l·∫ßn ƒë·∫øn nh·ªØng th·ª© ch√∫ng t√¥i l∆∞u v√†o b·ªô nh·ªõ ƒë·ªÉ b·∫°n s·ª≠ d·ª•ng.

N√≥ ƒë√°ng ch√∫ √Ω v√† c√≥ l·∫Ω b·∫°n c≈©ng ƒë√£ nh·∫≠n th·∫•y, c√°c gi√° tr·ªã ƒë∆∞·ª£c l∆∞u tr·ªØ theo th·ª© t·ª± ng∆∞·ª£c l·∫°i so v·ªõi nh·ªØng g√¨ ta bi·ªÉu di·ªÖn ch√∫ng.

C√≥ 1 v√≠ d·ª• sau:

    [0x1330] = 0x00000000deadc0de

N·∫øu b·∫°n th·ª≠ ki·∫øm tra th√¨ h√£y nh√¨n v√†o memory, b·∫°n s·∫Ω th·∫•y nh∆∞ sau:

    [0x1330] = 0xde
    [0x1331] = 0xc0
    [0x1332] = 0xad
    [0x1333] = 0xde
    [0x1334] = 0x00
    [0x1335] = 0x00
    [0x1336] = 0x00
    [0x1337] = 0x00

Format d·∫°ng n√†y l∆∞u tr·ªØ m·ªçi th·ª© theo ki·ªÉu ng∆∞·ª£c l·∫°i nh∆∞ n√†y l√† c·ªë √Ω trong x86, and n√≥ ƒë∆∞·ª£c g·ªçi l√† "Little Endian".

ƒê·ªëi v·ªõi th·ª≠ th√°ch l·∫ßn n√†y, ch√∫ng t√¥i s·∫Ω g·ª≠i cho b·∫°n 2 ƒë·ªãa ch·ªâ ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°i m·ªói khi run.

ƒê·ªãa ch·ªâ ƒë·∫ßu ti√™n s·∫Ω ƒë∆∞·ª£c ƒë·∫∑t t·∫°i ```rdi```, v√† ƒë·ªãa ch·ªâ th·ª© 2 ƒë∆∞·ª£c ƒë·∫∑t t·∫°i ```rsi```.

Nhi·ªám v·ª• c·ªßa b√†i:
- ƒê·∫∑t `[rdi] = 0xdeadbeef00001337`
- ƒê·∫∑t `[rsi] = 0xc0ffee0000`

G·ª£i √Ω: N√≥ c√≥ l·∫Ω s·∫Ω y√™u c·∫ßu 1 v√†i trick ƒë·∫∑t 1 h·∫±ng s·ªë l·ªõn cho thanh khi kh√¥ng tham chi·∫øu. Th·ª≠ thi·∫øt l·∫≠p m·ªôt thanh ghi th√†nh gi√° tr·ªã h·∫±ng s·ªë, sau ƒë√≥ g√°n thanh ghi ƒë√≥ cho thanh ghi kh√¥ng tham chi·∫øu.

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng ph√©p to√°n `mov` ƒë·ªÉ g√°n gi√° tr·ªã t∆∞∆°ng ·ª©ng cho 2 ƒë·ªãa ch·ªâ ƒë∆∞·ª£c l∆∞u ·ªü 2 thanh ghi `rdi` v√† `rsi`. Tuy nhi√™n, ta kh√¥ng th·ªÉ g√°n tr·ª±c ti·∫øp nh∆∞ sau:

    mov [address], value

V√¨ th·∫ø m√¨nh s·∫Ω truy·ªÅn gi√° tr·ªã qua cho 1 thanh ghi sau ƒë√≥ truy·ªÅn t·ª´ thanh ghi ƒë√≥ v√†o ƒë·ªãa ch·ªâ t∆∞∆°ng ·ª©ng ƒë√≥:
-   `mov rax, 0xdeadbeef00001337`
-   `mov [rdi], rax`
-   `mov rax, 0xc0ffee0000`
-   `mov [rsi], rax`


```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rax, 0xdeadbeef00001337
    mov [rdi], rax
    mov rax, 0xc0ffee0000
    mov [rsi], rax
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{cQq3fNjzaEerE60RefQpwxg6R1u.dVDMywCMxADNwEzW}```

---

### Level 18 - memory-sum

--- 

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

ƒê·ªëi v·ªõi c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi menory. ƒêi·ªÅu s·∫Ω s·∫Ω y√™u c·∫ßu b·∫°n ƒë·ªçc v√† ghi d·ªØ li·ªáu tuy·∫øn t√≠nh trong memory. N·∫øu b·∫°n c√≤n b·ªëi r·ªëi, h√£y th·ª≠ nh√¨n v√†o ƒë·ªãa ch·ªâ tuy·∫øn t√≠nh. B·∫°n c≈©ng c√≥ th·ªÉ y√™u c·∫ßu h·ªßy tham chi·∫øu nhi·ªÅu l·∫ßn ƒë·∫øn nh·ªØng th·ª© ch√∫ng t√¥i l∆∞u v√†o b·ªô nh·ªõ ƒë·ªÉ b·∫°n s·ª≠ d·ª•ng.

Nh·ªõ l·∫°y r·∫±ng memory ƒë∆∞·ª£c l∆∞u theo ƒë∆∞·ªùng th·∫≥ng.

ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† g√¨?
Ch√∫ng ta c√≥ th·ªÉ truy c·∫≠p v√†o ƒë·ªãa ch·ªâ `0x1337`:

    [0x1337] = 0x00000000deadbeef

C√°ch b·ªë tr√≠ b·ªô nh·ªõ th·ª±c s·ª± l√† theo t·ª´ng byte, `little endian`:

    [0x1337] = 0xef
    [0x1337 + 1] = 0xbe
    [0x1337 + 2] = 0xad
    ...
    [0x1337 + 7] = 0x00

ƒêi·ªÅu n√†y c√≥ t√°c d·ª•ng g√¨ v·ªõi ch√∫ng ta?
Well, n√≥ c√≥ nghƒ©a l√† ch√∫ng ta c√≥ th·ªÉ truy c·∫≠p v√†o nh·ªØng th·ª© n·∫±m c·∫°nh nhau b·∫±ng c√°ch s·ª≠ d·ª•ng offsets, gi·ªëng nh∆∞ nh·ªØng g√¨ ƒë√£ show ·ªü tr√™n.

Gi·∫£ s·ª≠ b·∫°n mu·ªën byte th·ª© 5 t·ª´ 1 ƒë·ªãa ch·ªâ, b·∫°n c√≥ th·ªÉ th·ª≠ truy c·∫≠p nh∆∞ sau:
   
    mov al, [address+4]

Nh·∫Øc l·∫°i, offsets b·∫Øt ƒë·∫ßu t·ª´ 0.

Nhi·ªám v·ª• c·ªßa b√†i:
- Load 2 gi√° tr·ªã li√™n ti·∫øp c√≥ k√≠ch th∆∞·ªõc quad words t·ª´ ƒë·ªãa ch·ªâ ƒë∆∞·ª£c l∆∞u ·ªü `rdi`.
- Th·ª±c hi·ªán t√≠nh t·ªïng gi√° tr·ªã t·ª´ b∆∞·ªõc tr∆∞·ªõc.
- L∆∞u t·ªïng t·∫°i ƒë·ªãa ch·ªâ ƒë∆∞·ª£c l∆∞u ·ªü `rdi`

--- 

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c to√°n t·ª≠ nh∆∞ `mov` v√† `add` ƒë·ªÉ t√≠nh to√°n c√°c gi√° tr·ªã ph√π h·ª£p ƒë∆∞·ª£c l∆∞u t·∫°i c√°c ƒë·ªãa ch·ªâ v√† c√°c thanh ghi:

-   `mov rax, [rdi]`
-   `mov rbx, [rdi + 8]`
-   `add rax, rbx`
-   `mov [rsi], rax`


```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rax, [rdi]
    mov rbx, [rdi + 8]
    add rax, rbx
    mov [rsi], rax
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{4eaKS2EFr1rHQEQAFLZlqCP-mm4.dZDMywCMxADNwEzW}```

---

### Level 19 - stack-subtraction

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi stack, v√πng nh·ªõ s·∫Ω c√≥ kh·∫£ nƒÉng m·ªü r·ªông v√† co l·∫°i 1 c√°ch linh ho·∫°t. B·∫°n s·∫Ω ƒë∆∞·ª£c y√™u c·∫ßu ƒë·ªçc v√† ghi v√†o stack, n√≥ y√™u c·∫ßu b·∫°n s·∫Ω s·ª≠ d·ª•ng `pop` v√† `push`. C√≥ l·∫Ω b·∫°n c≈©ng s·∫Ω c·∫ßn s·ª≠ d·ª•ng thanh ghi con tr·ªè ngƒÉn x·∫øp (pointer register -> `rsp`) ƒë∆∞·ª£c hi·ªÉu l√† con tr·ªè c·ªßa ngƒÉn x·∫øp.

Trong nh·ªØng c·∫•p ƒë·ªô n√†y, ch√∫ng ta s·∫Ω c√πng gi·ªõi thi·ªáu v·ªÅ stack.

Stack l√† 1 v√πng c·ªßa b·ªô nh·ªõ c√≥ th·ªÉ l∆∞u gi√° tr·ªã ƒë·ªÉ s·ª≠ d·ª•ng sau.

Khi m√† l∆∞u gi√° tr·ªã v√†o stack, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng l·ªánh `push`, v√† n·∫øu mu·ªën tr·∫£ v·ªÅ 1 ph·∫ßn t·ª≠ th√¨ ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng l·ªánh `pop`.

V√πng nh·ªõ stack ƒë∆∞·ª£c t·ªï ch·ª©c theo c·∫•u tr√∫c v√†o tr∆∞·ªõc ra sau(LIFO), v√† ƒëi·ªÅu n√†y c√≥ nghƒ©a l√† gi√° tr·ªã cu·ªëi c√πng ƒë∆∞·ª£c th√™m v√†o l√† gi√° tr·ªã ƒë·∫ßu ti√™u ƒë∆∞·ª£c b·ªè qua.

T∆∞·ªüng t∆∞·ª£ng vi·ªác d·ª° dƒ©a ra kh·ªèi m√°y r·ª≠a ch√©n. Gi·∫£ s·ª≠ c√≥ 1 qu·∫£ ƒë·ªè, 1 qu·∫£ xanh l√° c√¢y v√† 1 qu·∫£ xanh d∆∞∆°ng. ƒê·∫ßu ti√™n, ta ƒë·∫∑t qu·∫£ ƒë·ªè v√†o t·ªß, sau ƒë√≥ ƒë·∫∑t qu·∫£ xanh l√° c√¢y l√™n tr√™n qu·∫£ ƒë·ªè, r·ªìi ƒë·∫øn qu·∫£ xanh d∆∞∆°ng.

Ch·ªìng dƒ©a c·ªßa ch√∫ng ta s·∫Ω ƒë∆∞·ª£c trong nh∆∞ th·∫ø n√†y:

    Top ----> Blue
              Green
    Bottom -> Red

B√¢y gi·ªù, n·∫øu ch√∫ng ta mu·ªën 1 c√°i dƒ©a ƒë·ªÉ l√†m b√°nh sandwich, ch√∫ng ta s·∫Ω tr·∫£ v·ªÅ c√°i dƒ©a tr√™n c√πng c·ªßa stack, v√¨ n√≥ l√† chi·∫øc dƒ©a cu·ªëi c√πng ƒë∆∞·ª£c v√†o trong t·ªß, n√™n n√≥ l√† chi·∫øc dƒ©a ƒë·∫ßu ti√™n ƒë∆∞·ª£c l·∫•y ra.

Trong x86, l·ªánh `pop` s·∫Ω l·∫•y gi√° tr·ªã t·ª´ ƒë·ªânh c·ªßa stack v√† l∆∞u v√†o 1 thanh ghi n√†o ƒë√≥.

T∆∞∆°ng t·ª±, l·ªánh `push` s·∫Ω l·∫•y gi√° tr·ªã ·ªü trong 1 thanh ghi v√† th√™m v√†o tr√™n ƒë·ªânh c·ªßa stack.

S·ª≠ d·ª•ng nh·ªØng l·ªánh tr√™n.

Nhi·ªám v·ª• c·ªßa b√†i:
- L·∫•y gi√° tr·ªã tr√™n c√πng c·ªßa stack
- Sau ƒë√≥ ƒëem tr·ª´ cho `rdi`
- V√† cu·ªëi c√πng l√† th√™m l·∫°i v√†o ƒë·ªânh c·ªßa stack

--- 

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c l·ªánh ƒë∆∞·ª£c n√™u ·ªü tr√™n ƒë√≥ l√† `pop` v√† `push` ƒë·ªÉ c√≥ th·ªÉ t∆∞∆°ng t√°c v·ªõi stack:

-   `pop rax`
-   `sub rax, rdi`
-   `push rax`


```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    pop rax
    sub rax, rdi
    push rax
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{0bMhlV53LjYtukPepUva60WVjdI.ddDMywCMxADNwEzW}```

---

### Level 20 - swap-stack-values

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi `stack`, v√πng nh·ªõ s·∫Ω c√≥ kh·∫£ nƒÉng m·ªü r·ªông v√† co l·∫°i 1 c√°ch linh ho·∫°t. B·∫°n s·∫Ω ƒë∆∞·ª£c y√™u c·∫ßu ƒë·ªçc v√† ghi v√†o `stack`, n√≥ y√™u c·∫ßu b·∫°n s·∫Ω s·ª≠ d·ª•ng `pop` v√† `push`. C√≥ l·∫Ω b·∫°n c≈©ng s·∫Ω c·∫ßn s·ª≠ d·ª•ng thanh ghi con tr·ªè ngƒÉn x·∫øp (pointer register -> `rsp`) ƒë∆∞·ª£c hi·ªÉu l√† con tr·ªè c·ªßa ngƒÉn x·∫øp.

ƒê·ªëi v·ªõi c·∫•p ƒë·ªô n√†y, ch√∫ng ta s·∫Ω kh√°m ph√° c·∫•u tr√∫c v√†o tr∆∞·ªõc ra sau trong `stack`.

Ch·ªâ s·ª≠ d·ª•ng c√°c l·ªánh sau:
- `push`
- `pop`

Nhi·ªám c·ª• c·ªßa b√†i:

    ƒê·ªëi ch·ªï 2 gi√° tr·ªã ·ªü `rdi` v√† `rsi`.

    V√≠ d·ª•:
    - N·∫øu ban ƒë·∫ßu t·∫°i rdi = 2 v√† rsi = 5
    - Th√¨ l√∫c k·∫øt th√∫c rdi = 5, v√† rsi = 2`

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng c√°c l·ªánh ƒë∆∞·ª£c n√™u ·ªü tr√™n ƒë√≥ l√† `pop` v√† `push` ƒë·ªÉ c√≥ th·ªÉ t∆∞∆°ng t√°c v·ªõi stack:

-   `push rdi`
-   `push rsi`
-   `pop rdi`
-   `pop rsi`


```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    push rdi
    push rsi
    pop rdi
    pop rsi
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{Ax8XdJMcTntp3jk_mSam_VfEkx1.dhDMywCMxADNwEzW}```

---

### Level 21 - average-stack-values

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi `stack`, v√πng nh·ªõ s·∫Ω c√≥ kh·∫£ nƒÉng m·ªü r·ªông v√† co l·∫°i 1 c√°ch linh ho·∫°t. B·∫°n s·∫Ω ƒë∆∞·ª£c y√™u c·∫ßu ƒë·ªçc v√† ghi v√†o `stack`, n√≥ y√™u c·∫ßu b·∫°n s·∫Ω s·ª≠ d·ª•ng `pop` v√† `push`. C√≥ l·∫Ω b·∫°n c≈©ng s·∫Ω c·∫ßn s·ª≠ d·ª•ng thanh ghi con tr·ªè ngƒÉn x·∫øp (pointer register -> `rsp`) ƒë∆∞·ª£c hi·ªÉu l√† con tr·ªè c·ªßa ngƒÉn x·∫øp.

Trong c·∫•p ƒë·ªô tr∆∞·ªõc, b·∫°n ƒë√£ s·ª≠ d·ª•ng `push` v√† `pop` ƒë·ªÉ l∆∞u v√† load d·ªØ li·ªáu t·ª´ stack. Tuy nhi√™n, b·∫°n c≈©ng c√≥ th·ªÉ truy c·∫≠p tr·ª±c ti·∫øp v√†o stack b·∫±ng c√°ch s·ª≠ d·ª•ng con tr·ªè ngƒÉn x·∫øp.

Trong x86, ƒë·ªãa ch·ªâ ngƒÉn x·∫øp ƒë∆∞·ª£c l∆∞u trong thanh ghi ƒë·∫∑c bi·ªát (`rsp`). `rsp` th∆∞·ªùng l∆∞u tr·ªØ ƒë·ªãa ch·ªâ b·ªô nh·ªõ c·ªßa ƒë·ªânh stack. L√† ƒë·ªãa ch·ªâ c·ªßa ph·∫ßn t·ª≠ ƒë∆∞·ª£c th√™m v√†o cu·ªëi stack.

T∆∞∆°ng t·ª± nh∆∞ c√°c c·∫•p ƒë·ªô tr∆∞·ªõc, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng `[rsp]` ƒë·ªÉ truy c·∫≠p v√†o gi√° tr·ªã ƒë∆∞·ª£c l∆∞u t·∫°i ƒë·ªãa ch·ªâ trong `rsp`.

Nhi·ªám v·ª• c·ªßa b√†i:
- Kh√¥ng s·ª≠ d·ª•ng `pop`, h√£y t√≠nh to√°n gi√° tr·ªã trung b√¨nh c·ªßa c√°c ph·∫ßn t·ª≠ c√≥ ki·ªÉu d·ªØ li·ªáu `quad word` ƒë∆∞·ª£c l∆∞u li√™n ti·∫øp tr√™n stack. Th√™m gi√° tr·ªã trung b√¨nh v√†o stack.
- Hint:
    - RSP+0x?? Quad Word A
    - RSP+0x?? Quad Word B
    - RSP+0x?? Quad Word C
    - RSP Quad Word D

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh truy c·∫≠p tr·ª±c ti·∫øp v√†o c√°c ƒë·ªãa ch·ªâ li√™n ti·∫øp v√† b·∫Øt ƒë·∫ßu l√† ƒë·ªãa ch·ªâ ƒë∆∞·ª£c l∆∞u t·∫°i thanh ghi `rsp`, sau ƒë√≥ m√¨nh s·∫Ω t√≠nh gi√° tr·ªã trung b√¨nh v√† ƒë·∫©y l√™n `stack`:

-    `mov rax, [rsp]`
-    `add rax, [rsp + 8]`
-    `add rax, [rsp + 16]`
-    `add rax, [rsp + 24]`
-    `mov rbx, 0x4`
-    `div rbx`
-    `push rax`


```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rax, [rsp]
    add rax, [rsp + 8]
    add rax, [rsp + 16]
    add rax, [rsp + 24]
    mov rbx, 0x4
    div rbx
    push rax
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{IBbMl_zp-x6AkWRvgllLkw7QUdE.dlDMywCMxADNwEzW}```

---

### Level 22 - absolute-jump

--- 

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω ƒë∆∞·ª£c l√†m vi·ªác v·ªõi ki·ªÉm so√°t thao t√°c lu·ªìng. ƒêi·ªÅu n√†y li√™n quan ƒë·∫øn vi·ªác s·ª≠ d·ª•ng c√°c h∆∞·ªõng d·∫´n gi√°n ti·∫øp ho·∫∑c tr·ª±c ti·∫øp ƒë·ªÉ ƒëi·ªÅu khi·ªÉn c√°c thanh ghi ƒë·∫∑c bi·ªát `rip`, con tr·ªè l·ªánh. B·∫°n s·∫Ω s·ª≠ d·ª•ng c√°c l·ªánh nh∆∞ `jmp`, `call`, `cmp`, v√† 1 s·ªë l·ª±a ch·ªçn thay th·∫ø vi·ªác th·ª±c hi·ªán c√°c y√™u c·∫ßu h√†nh vi. 

Tr∆∞·ªõc ƒë√≥, b·∫°n ƒë√£ h·ªçc v·ªÅ l√†m c√°ch n√†o ƒë·ªÉ thao t√°c data trong `pseudo-control` (ki·ªÉm so√°t gi·∫£), nh∆∞ng x86 th·ª±c s·ª± cung c·∫•p c√°c h∆∞·ªõng d·∫´n cho b·∫°n ki·ªÉm so√°t lu·ªìng tr·ª±c ti·∫øp.

C√≥ 2 c√°ch ch√≠nh ƒë·ªÉ ƒëi·ªÅu khi·ªÉn lu·ªìng ƒëi·ªÅu khi·ªÉn:
- G·ªçi l·ªánh `jump`
- G·ªçi l·ªánh `call`

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi jumps.

C√≥ 2 lo·∫°i jumps.
- jumps c√≥ ƒëi·ªÅu ki·ªán
- jumps kh√¥ng c√≥ ƒëi·ªÅu ki·ªán

Jumps kh√¥ng c√≥ ƒëi·ªÅu ki·ªán lu√¥n ƒë∆∞·ª£c k√≠ch ho·∫°t v√† kh√¥ng d·ª±a tr√™n k·∫øt qu·∫£ c·ªßa c√°c l·ªánh tr∆∞·ªõc ƒë√≥.

Nh∆∞ b·∫°n ƒë√£ bi·∫øt, v√πng nh·ªõ c√≥ th·ªÉ l∆∞u data v√† c√°c instructions. Code c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c l∆∞u t·∫°i `0x400042` (ƒëi·ªÅu n√†y s·∫Ω thay ƒë·ªïi m·ªói khi ch·∫°y).

Trong t·∫•t c·∫£ c√°c jumps, c√≥ 3 lo·∫°i nh∆∞ sau:
- Nh·∫£y t∆∞∆°ng ƒë·ªëi (relative jumps): jump + or - next instruction.
- Nh·∫£y tuy·ªát ƒë·ªëi (absolute jumps): nh·∫£y t·ªõi ƒë·ªãa ch·ªâ c·ª• th·ªÉ
- Nh·∫£y gi√°n ti·∫øp (indirect jumps): nh·∫£y t·ªõi ƒë·ªãa ch·ªâ c·ª• th·ªÉ trong thanh ghi.

Trong x86, l·ªánh nh·∫£y tuy·ªát ƒë·ªëi (nh·∫£y ƒë·∫øn m·ªôt ƒë·ªãa ch·ªâ c·ª• th·ªÉ) ƒë∆∞·ª£c th·ª±c hi·ªán b·∫±ng c√°ch ƒë·∫ßu ti√™n t·∫£i ƒë·ªãa ch·ªâ ƒë√≠ch v√†o m·ªôt thanh ghi m·ª•c ƒë√≠ch chung (ch√∫ng ta s·∫Ω g·ªçi thanh ghi gi·ªØ ch·ªó n√†y l√† `reg`), sau ƒë√≥ th·ª±c hi·ªán l·ªánh `jmp reg`.

Trong c·∫•p ƒë·ªô n√†y, ch√∫ng t√¥i s·∫Ω y√™u c·∫ßu b·∫°n th·ª±c hi·ªán 1 l·ªánh nh·∫£y tuy·ªát ƒë·ªëi. 

Nhi·ªám v·ª• c·ªßa b√†i:
- Nh·∫£y t·ªõi ƒë·ªãa ch·ªâ tuy·ªát ƒë·ªëi: `0x403000`.

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω truy·ªÅn ƒë·ªãa ch·ªâ ƒë·ªÉ nh·∫£y v√†o 1 thanh ghi, sau ƒë√≥ jumps t·ªõi thanh ghi ƒë√≥:

-   `mov rax, 0x403000`
-   `jmp rax`


```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rax, 0x403000
    jmp rax
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{Yrzc6mRCx6gt0MwNMsDezmAp_qv.QX1EDOzwCMxADNwEzW}```

---

### Level 23 - relative-jump

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω ƒë∆∞·ª£c l√†m vi·ªác v·ªõi ki·ªÉm so√°t thao t√°c lu·ªìng. ƒêi·ªÅu n√†y li√™n quan ƒë·∫øn vi·ªác s·ª≠ d·ª•ng c√°c h∆∞·ªõng d·∫´n gi√°n ti·∫øp ho·∫∑c tr·ª±c ti·∫øp ƒë·ªÉ ƒëi·ªÅu khi·ªÉn c√°c thanh ghi ƒë·∫∑c bi·ªát `rip`, con tr·ªè l·ªánh. B·∫°n s·∫Ω s·ª≠ d·ª•ng c√°c l·ªánh nh∆∞ `jmp`, `call`, `cmp`, v√† 1 s·ªë l·ª±a ch·ªçn thay th·∫ø vi·ªác th·ª±c hi·ªán c√°c y√™u c·∫ßu h√†nh vi. 

Nh·ªõ l·∫°i r·∫±ng trong t·∫•t c·∫£ c√°c jumps, c√≥ 3 lo·∫°i nh∆∞ sau:
- Nh·∫£y t∆∞∆°ng ƒë·ªëi (relative jumps)
- Nh·∫£y tuy·ªát ƒë·ªëi (absolute jumps)
- Nh·∫£y gi√°n ti·∫øp (indirect jumps)

Trong c·∫•p ƒë·ªô n√†y, ch√∫ng t√¥i s·∫Ω y√™u c·∫ßu b·∫°n th·ª±c hi·ªán 1 l·ªánh nh·∫£y t∆∞∆°ng ƒë·ªëi. B·∫°n s·∫Ω c·∫ßn ƒëi·ªÅn 1 kho·∫£ng tr·ªëng trong code c·ªßa b·∫°n ƒë·ªÉ th·ª±c hi·ªán c√≥ nh·∫£y t∆∞∆°ng ƒë·ªëi n√†y. Ch√∫ng t√¥i g·ª£i √Ω s·ª≠ d·ª•ng l·ªánh `nop`. N√≥ d√†i 1 byte v√† r·∫•t d·ªÖ ƒëo√°n.

Trong th·ª±c t·∫ø, tr√¨nh bi√™n d·ªãch c·ªßa ch√∫ng t√¥i c√≥ s·ª≠ d·ª•ng 1 ti·ªán √≠ch, `.rept` n√≥i r·∫±ng b·∫°n c√≥ th·ªÉ l·∫∑p l·∫°i l·ªánh assembly 1 s·ªë l·∫ßn. 

C√°c l·ªánh h·ªØu √≠ch cho c·∫•p ƒë·ªô n√†y:
- `jmp`, `(reg1 | addr | offset)`   
- `nop`

G·ª£i √Ω: Trong nh·∫£y t∆∞∆°ng ƒë·ªëi, h√£y t√¨m hi·ªÉu c√°ch s·ª≠ d·ª•ng `x86`. 

S·ª≠ d·ª•ng nh·ªØng ki·∫øn th·ª©c ·ªü tr√™n, nhi·ªám v·ª• c·ªßa b√†i:
- ƒê·∫∑t l·ªánh ƒë·∫ßu ti√™n trong code c·ªßa b·∫°n l√† `jmp`.
- ƒê·∫∑t l·ªánh `jmp` t∆∞∆°ng ƒë·ªëi t·ªõi `0x51` bytes  t·ª´ v·ªã tr√≠ hi·ªán t·∫°i.
- T·∫°i v·ªã tr√≠ code ·ªü ƒë√¢y l√† t∆∞∆°ng ƒë·ªëi s·∫Ω chuy·ªÉn h∆∞·ªüng lu·ªìng ƒëi·ªÅu khi·ªÉn, ƒë·∫∑t `rax` th√†nh `0x1`.

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω s·ª≠ d·ª•ng l·ªánh `.rept` v√† `nop` ƒë·ªÉ t·∫°o ra m·ªôt kho·∫£ng code v·ªõi k√≠ch th∆∞·ªõc `0x51`. Sau ƒë√≥ m√¨nh s·∫Ω t·∫°o ra 1 label v√† jump t·ªõi label ƒë√≥.

-   `jmp rlt`
-   `.rept 0x51`
-   `    nop`
-   `.endr`
-   `rlt:`
-   `    mov rax, 0x1`

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    jmp rlt
    .rept 0x51
    nop
    .endrz
    rlt:
    mov rax, 0x1
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{gZIbnSCceZgFosyEjrEKENNK5Ra.QX2EDOzwCMxADNwEzW}```

---

### Level 24 - jump-trampoline

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

B√¢y gi·ªù ch√∫ng ta s·∫Ω set v√†i gi√° tr·ªã trong memory tr∆∞·ªõc ghi run. M·ªói l·∫ßn chay, c√°c gi√° tr·ªã ƒë√≥ s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c·∫ßn th·ª±c hi·ªán c√°c thao t√°c theo c√¥ng th·ª©c c√πng v·ªõi thanh ghi. Ch√∫ng t√¥i s·∫Ω n√≥i cho b·∫°n thanh ghi n√†o s·∫Ω ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc ƒë√≥ v√† b·∫°n n√™n th√™m n√≥ v√†o k·∫øt qu·∫£. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, ƒë√≥ l√† `rax`.

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω ƒë∆∞·ª£c l√†m vi·ªác v·ªõi ki·ªÉm so√°t thao t√°c lu·ªìng. ƒêi·ªÅu n√†y li√™n quan ƒë·∫øn vi·ªác s·ª≠ d·ª•ng c√°c h∆∞·ªõng d·∫´n gi√°n ti·∫øp ho·∫∑c tr·ª±c ti·∫øp ƒë·ªÉ ƒëi·ªÅu khi·ªÉn c√°c thanh ghi ƒë·∫∑c bi·ªát `rip`, con tr·ªè l·ªánh. B·∫°n s·∫Ω s·ª≠ d·ª•ng c√°c l·ªánh nh∆∞ `jmp`, `call`, `cmp`, v√† 1 s·ªë l·ª±a ch·ªçn thay th·∫ø vi·ªác th·ª±c hi·ªán c√°c y√™u c·∫ßu h√†nh vi. 

B√¢y gi·ªù, ch√∫ng t√¥i s·∫Ω g·ªôp 2 level tr∆∞·ªõc l·∫°i

Nhi·ªám v·ª• c·ªßa b√†i:

- T·∫°o 2 l·ªánh nh·∫£y:
    - ƒê·∫∑t l·ªánh ƒë·∫ßu ti√™n trong code c·ªßa b·∫°n l√† `jmp`.
    - ƒê·∫∑t l·ªánh `jmp` t∆∞∆°ng ƒë·ªëi t·ªõi `0x51` bytes  t·ª´ v·ªã tr√≠ hi·ªán t·∫°i.
    - T·∫°i 0x51, th·ª±c hi·ªán theo y√™u c·∫ßu sau:
        - ƒê·∫∑t gi√° tr·ªã tr√™n ƒë·ªânh c·ªßa stack v√†o thanh ghi `rdi`.
        - S·ª≠ d·ª•ng `jmp` ƒë·ªÉ th·ª±c hi·ªán nh·∫£y tuy·ªát ƒë·ªëi t·ªõi ƒë·ªãa ch·ªâ 0x403000.

---

#### L·ªùi gi·∫£i

B√†i n√†y m√¨nh s·∫Ω k·∫øt h·ª£p c√°c l·ªánh 2 c·∫•p ƒë·ªô tr∆∞·ªõc l·∫°i ƒë·ªÉ c√≥ th·ªÉ th·ª±c hi·ªán y√™u c·∫ßu c·ªßa b√†i. ƒê·∫ßu ti√™n m√¨nh s·∫Ω s·ª≠ d·ª•ng l·ªánh `.rept` v√† `nop` ƒë·ªÉ t·∫°o ra m·ªôt kho·∫£ng code v·ªõi k√≠ch th∆∞·ªõc `0x51`. Sau ƒë√≥ m√¨nh s·∫Ω t·∫°o ra 1 label v√† jump t·ªõi label ƒë√≥. Trong label ƒë√≥ m√¨nh s·∫Ω ƒë·∫∑t gi√° tr·ªã tr√™n ƒë·ªânh c·ªßa stack v√†o thanh ghi `rdi` v√† nh·∫£y t·ªõi ƒë·ªãa ch·ªâ `0x403000`.

-   `jmp rlt`
-   `.rept 0x51`
-   `nop`
-   `.endr`
-   `rlt:`
-   `pop rdi`
-   `mov rbx, 0x403000`
-   `jmp rbx`

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    jmp rlt
    .rept 0x51
        nop
    .endr
    rlt:
        pop rdi
        mov rbx, 0x403000
        jmp rbx
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{YmmK3ctHyLYm1CMhKmN3aUJeJsi.dBTMywCMxADNwEzW}```

---

### Level 25 - conditional-jump

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω ƒë∆∞·ª£c l√†m vi·ªác v·ªõi ki·ªÉm so√°t thao t√°c lu·ªìng. ƒêi·ªÅu n√†y li√™n quan ƒë·∫øn vi·ªác s·ª≠ d·ª•ng c√°c h∆∞·ªõng d·∫´n gi√°n ti·∫øp ho·∫∑c tr·ª±c ti·∫øp ƒë·ªÉ ƒëi·ªÅu khi·ªÉn c√°c thanh ghi ƒë·∫∑c bi·ªát `rip`, con tr·ªè l·ªánh. B·∫°n s·∫Ω s·ª≠ d·ª•ng c√°c l·ªánh nh∆∞ `jmp`, `call`, `cmp`, v√† 1 s·ªë l·ª±a ch·ªçn thay th·∫ø vi·ªác th·ª±c hi·ªán c√°c y√™u c·∫ßu h√†nh vi. 

Ch√∫ng t√¥i s·∫Ω ki·ªÉm tra m√£ c·ªßa b·∫°n nhi·ªÅu l·∫ßn trong th·ª≠ th√°ch l·∫ßn n√†y! ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ch√∫ng t√¥i s·∫Ω ch·∫°y code c·ªßa b·∫°n k·∫øt h·ª£p v·ªõi gi√° tr·ªã random trong m·ªói l·∫ßn ch·∫°y ƒë·ªÉ ƒë·∫£m b·∫£o r·∫±ng login c·ªßa b·∫°n ƒë√∫ng ƒë·ªÉ ƒë·ªß s·ª≠ d·ª•ng trong ƒëi·ªÅu ki·ªán s·ª≠ d·ª•ng b√¨nh th∆∞·ªùng.

Ch√∫ng t√¥i s·∫Ω gi·ªõi thi·ªáu cho b·∫°n v·ªÅ nh·∫£y nh∆∞ng c√≥ ƒëi·ªÅu ki·ªán. M·ªôt trong nh·ªØng l·ªánh c√≥ gi√° tr·ªã nh·∫•t trong x86. Trong ng√¥n ng·ªØ b·∫≠c cao, l·ªánh if-else ƒë∆∞·ª£c t·ªï ch·ª©c ki·ªÉu nh∆∞ sau:

    if x is even:
        is_even = 1
    else:
        is_even = 0

ƒêi·ªÅu n√†y nh√¨n n√≥ r·∫•t quen thu·ªôc v√¨ c√≥ th·ªÉ s·ª≠ d·ª•ng bit-logic, ƒëi·ªÅu m√† b·∫°n ƒë√£ th·ª±c hi·ªán ·ªü c·∫•p ƒë·ªô tr∆∞·ªõc. Trong nh·ªØng c·∫•u tr√∫c n√†y, b·∫°n c√≥ th·ªÉ ki·ªÉm so√°t ch∆∞∆°ng tr√¨nh ƒëi·ªÅu khi·ªÉn lu·ªìng th·ª±c thi v√†o nh·ªØng gi√° tr·ªã ƒë·ªông cung c·∫•p cho ch∆∞∆°ng tr√¨nh.

Th·ª±c thi c√°c logic ·ªü tr√™n c√πng v·ªõi jmps c√≥ th·ªÉ trong nh∆∞ sau:

    ; assume rdi = x, rax is output
    ; rdx = rdi mod 2
    mov rax, rdi
    mov rsi, 2
    div rsi
    ; remainder is 0 if even
    cmp rdx, 0
    ; jump to not_even code if it's not 0
    jne not_even
    ; fall through to even code
    mov rbx, 1
    jmp done
    ; jump to this only when not_even
    not_even:
    mov rbx, 0
    done:
    mov rax, rbx
    ; more instructions here

Tuy nhi√™n, b·∫°n mu·ªën nhi·ªÅu h∆°n ch·ª© kh√¥ng ch·ªâ m·ªói `if-else`. ƒê√¥i khi b·∫°n mu·ªën s·ª≠ d·ª•ng 2 c√¢u l·ªánh if, theo sau l√† `else`. ƒê·ªÉ l√†m ƒë∆∞·ª£c ƒëi·ªÅu ƒë√≥, b·∫°n c·∫ßn ch·∫Øc ch·∫Øn r·∫±ng b·∫°n ƒë√£ c√≥ lu·ªìng ƒëi·ªÅu khi·ªÉn qua 'falls-though` n·∫øu n√≥ b·ªã l·ªói. T·∫•t c·∫£ ph·∫£i nh·∫£y ƒë·∫øn 1 th·ª±c hi·ªán ƒë·ªÉ tr√°ch ng∆∞·ªùi d√πng kh√°c.

C√≥ r·∫•t nhi·ªÅu d·∫°ng jumps trong x86, s·∫Ω r·∫•t h·ªØu √≠ch khi ch√∫ng ta h·ªçc c√°ch s·ª≠ d·ª•ng. G·∫ßn nh∆∞ t·∫•t c·∫£ ƒë·ªÅu d·ª±a v√†o nh·ªØng th·ª© ƒë∆∞·ª£c g·ªçi l√† ZF,  Zero Flag. ZF s·∫Ω ƒë∆∞·ª£c set th√†nh 1 khi ch√∫ng ta th·ª±c hi·ªán so s√°ch v√† cho ra k·∫øt qu·∫£ l√† b·∫±ng nhau, v√† 0 v·ªõi tr∆∞·ªùng h·ª£p c√≤n l·∫°i.

S·ª≠ d·ª•ng nh·ªØng ki·∫øn th·ª©c ƒë∆∞·ª£c cho ·ªü tr√™n.

Nhi·ªám v·ª• c·ªßa b√†i:

    if [x] is 0x7f454c46:
        y = [x+4] + [x+8] + [x+12]
    else if [x] is 0x00005A4D:
        y = [x+4] - [x+8] - [x+12]
    else:
        y = [x+4] * [x+8] * [x+12]

·ªû ƒë√¢y:
- x = edi, y = eax.

Cho r·∫±ng m·ªói gi√° tr·ªã h·ªßy tham chi·∫øu l√† gi√° tr·ªã dword ƒë∆°n l·∫ª. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† gi√° tr·ªã c√≥ th·ªÉ b·∫Øt ƒë·∫ßu b·∫±ng m·ªôt gi√° tr·ªã √¢m trong m·ªói v√πng nh·ªõ.

M·ªôt gi·∫£i ph√°p h·ª£p l·ªá s·∫Ω s·ª≠ d·ª•ng c√°c l·ªánh ƒë∆∞·ª£c cho nh∆∞ sau √≠t nh·∫•t 1 l·∫ßn:
-   `jmp`, `cmp`    

---

#### L·ªùi gi·∫£i

B√†i n√†y c√≥ 3 tr∆∞·ªùng h·ª£p, n√™n m√¨nh s·∫Ω vi·∫øt t·ª´ng label cho t·ª´ng tr∆∞·ªùng h·ª£p ƒë√≥. Ban ƒë·∫ßu m√¨nh s·∫Ω vi·∫øt label ƒë·∫ßu cho tr∆∞·ªùng h·ª£p ƒë·∫ßu ti√™n, ti·∫øp theo n·∫øu trong label ƒë√≥ m√† so s√°ch kh√¥ng kh·ªõp th√¨ n√≥ s·∫Ω nh·∫£y sang label th·ª© 2, v√† ti·∫øp t·ª•c n·∫øu kh√¥ng kh·ªõp n·ªØa th√¨ s·∫Ω nh·∫£y v√†o label cu·ªëi c√πng v√† th·ª±c hi·ªán ·ªü ƒë√¢y m√† kh√¥ng so s√°nh n·ªØa. Trong m·ªói label sau khi so s√°nh h·ª£p l·ªá v√† th·ª±c hi·ªán h·∫øt m√¨nh s·∫Ω nh·∫£y t·ªõi label done.

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    jmp .check1

    .check1:
        cmp dword ptr [edi], 0x7f454c46
        jne .check2

        mov eax, dword ptr [rdi + 0x4]
        add eax, dword ptr [rdi + 0x8]
        add eax, dword ptr [rdi + 0xc]
        
        jmp .done

    .check2:
        cmp dword ptr [edi], 0x00005A4D
        jne .else

        mov eax, dword ptr [rdi + 0x4]
        sub eax, dword ptr [rdi + 0x8]
        sub eax, dword ptr [rdi + 0xc]

        jmp .done

    .else:
        mov eax, dword ptr [rdi + 0x4]
        imul eax, dword ptr [rdi + 0x8]
        imul eax, dword ptr [rdi + 0xc]

        jmp .done

    .done:
        nop
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{sd2RjHgda2tWZDtMJYG-U7jB3M1.dFTMywCMxADNwEzW}```

---

### Level 26 - indicrect-jump

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

Trong c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω ƒë∆∞·ª£c l√†m vi·ªác v·ªõi ki·ªÉm so√°t thao t√°c lu·ªìng. ƒêi·ªÅu n√†y li√™n quan ƒë·∫øn vi·ªác s·ª≠ d·ª•ng c√°c h∆∞·ªõng d·∫´n gi√°n ti·∫øp ho·∫∑c tr·ª±c ti·∫øp ƒë·ªÉ ƒëi·ªÅu khi·ªÉn c√°c thanh ghi ƒë·∫∑c bi·ªát `rip`, con tr·ªè l·ªánh. B·∫°n s·∫Ω s·ª≠ d·ª•ng c√°c l·ªánh nh∆∞ `jmp`, `call`, `cmp`, v√† 1 s·ªë l·ª±a ch·ªçn thay th·∫ø vi·ªác th·ª±c hi·ªán c√°c y√™u c·∫ßu h√†nh vi. 

Ch√∫ng t√¥i s·∫Ω ki·ªÉm tra m√£ c·ªßa b·∫°n nhi·ªÅu l·∫ßn trong th·ª≠ th√°ch l·∫ßn n√†y! ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ch√∫ng t√¥i s·∫Ω ch·∫°y code c·ªßa b·∫°n k·∫øt h·ª£p v·ªõi gi√° tr·ªã random trong m·ªói l·∫ßn ch·∫°y ƒë·ªÉ ƒë·∫£m b·∫£o r·∫±ng login c·ªßa b·∫°n ƒë√∫ng ƒë·ªÉ ƒë·ªß s·ª≠ d·ª•ng trong ƒëi·ªÅu ki·ªán s·ª≠ d·ª•ng b√¨nh th∆∞·ªùng.

Lo·∫°i nh·∫£y cu·ªëi c√πng l√† nh·∫£y gi√°n ti·∫øp (indirect jump), th∆∞·ªùng ƒë∆∞·ª£c d√πng cho c√¢u l·ªánh `switch` trong l·∫≠p tr√¨nh th·ª±c t·∫ø. C√¢u l·ªánh `switch` l√† m·ªôt d·∫°ng ƒë·∫∑c bi·ªát c·ªßa c·∫•u tr√∫c if-else, nh∆∞ng ch·ªâ s·ª≠ d·ª•ng s·ªë ƒë·ªÉ x√°c ƒë·ªãnh lu·ªìng ƒëi·ªÅu khi·ªÉn s·∫Ω ƒëi ƒë√¢u.

V√≠ d·ª•:  

    switch(number):
    0: jmp do_thing_0
    1: jmp do_thing_1
    2: jmp do_thing_2
    default: jmp do_default_thing

Trong v√≠ d·ª• n√†y, `switch` ho·∫°t ƒë·ªông tr√™n bi·∫øn `number`, c√≥ th·ªÉ l√† 0, 1 ho·∫∑c 2. N·∫øu `number` kh√¥ng n·∫±m trong c√°c gi√° tr·ªã ƒë√≥, l·ªánh m·∫∑c ƒë·ªãnh s·∫Ω ch·∫°y. B·∫°n c√≥ th·ªÉ coi ƒë√¢y l√† m·ªôt phi√™n b·∫£n r√∫t g·ªçn c·ªßa c·∫•u tr√∫c `else-if`. Trong x86, v√¨ ta th∆∞·ªùng xuy√™n l√†m vi·ªác v·ªõi s·ªë, n√™n kh√¥ng ng·∫°c nhi√™n khi c√≥ th·ªÉ ƒë∆∞a ra quy·∫øt ƒë·ªãnh d·ª±a tr√™n gi√° tr·ªã c·ª• th·ªÉ. N·∫øu bi·∫øt r√µ ph·∫°m vi c·ªßa c√°c s·ªë, c√¢u l·ªánh switch ho·∫°t ƒë·ªông r·∫•t hi·ªáu qu·∫£.

V√≠ d·ª•: m·ªôt jump table l√† m·ªôt v√πng b·ªô nh·ªõ li√™n ti·∫øp l∆∞u c√°c ƒë·ªãa ch·ªâ c·∫ßn nh·∫£y t·ªõi.

B·∫£ng nh·∫£y c√≥ th·ªÉ tr√¥ng nh∆∞ sau:

    [0x1337]      = ƒë·ªãa ch·ªâ do_thing_0
    [0x1337+0x8]  = ƒë·ªãa ch·ªâ do_thing_1
    [0x1337+0x10] = ƒë·ªãa ch·ªâ do_thing_2
    [0x1337+0x18] = ƒë·ªãa ch·ªâ do_default_thing

Khi ƒë√≥, thay v√¨ nhi·ªÅu l·ªánh cmp, ta ch·ªâ c·∫ßn ki·ªÉm tra xem number c√≥ l·ªõn h∆°n 2 kh√¥ng. N·∫øu l·ªõn h∆°n, lu√¥n nh·∫£y ƒë·∫øn:
- `jmp [0x1337+0x18]`

Ng∆∞·ª£c l·∫°i:
- `jmp [jump_table_address + number * 8]`

Nhi·ªám v·ª• c·ªßa b√†i:

    if rdi == 0:
        jmp 0x40301e
    else if rdi == 1:
        jmp 0x4030da
    else if rdi == 2:
        jmp 0x4031d5
    else if rdi == 3:
        jmp 0x403286
    else:
        jmp 0x4932c

R√†ng bu·ªôc

- Gi·∫£ s·ª≠ rdi s·∫Ω kh√¥ng √¢m.
-   Kh√¥ng d√πng qu√° 1 l·ªánh cmp.
-   Kh√¥ng d√πng qu√° 3 l·ªánh jmp (m·ªçi lo·∫°i).
-   Ch√∫ng t√¥i s·∫Ω cung c·∫•p s·ªë ƒë·ªÉ switch trong rdi.
-   Ch√∫ng t√¥i c≈©ng s·∫Ω cung c·∫•p ƒë·ªãa ch·ªâ c∆° s·ªü c·ªßa jump table trong rsi.

V√≠ d·ª• cho 1 b·∫£ng:

    [0x40427c] = 0x40301e
    [0x404284] = 0x4030da
    [0x40428c] = 0x4031d5
    [0x404294] = 0x403286

--- 

#### L·ªùi gi·∫£i:
B√†i n√†y ban ƒë·∫ßu m√¨nh s·∫Ω so s√°nh rdi v·ªõi 3, v√† n·∫øu rdi nh·ªè h∆°n ho·∫∑c b·∫±ng 3
th√¨ m√¨nh s·∫Ω nh·∫£y ƒë·∫øn `[8 * rdi + rsi]`.

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    cmp rdi, 0x3
    jbe .else
    mov rdi, 4

    .else:
        mov rax, [rdi * 8 + rsi]
        jmp rax
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{cVHVmKjaKUTcS6XbGBrIHC2zQ3b.dJTMywCMxADNwEzW}```

---

### Level 27 - average-loop

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

Ch√∫ng ta s·∫Ω thi·∫øt l·∫≠p m·ªôt s·ªë gi√° tr·ªã trong b·ªô nh·ªõ `ƒë·ªông` tr∆∞·ªõc m·ªói l·∫ßn ch·∫°y. ·ªû m·ªói l·∫ßn ch·∫°y, c√°c gi√° tr·ªã s·∫Ω thay ƒë·ªïi. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n s·∫Ω c·∫ßn th·ª±c hi·ªán m·ªôt s·ªë ph√©p to√°n c√¥ng th·ª©c v·ªõi c√°c thanh ghi. Ch√∫ng t√¥i s·∫Ω cho b·∫°n bi·∫øt thanh ghi n√†o ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc v√† b·∫°n n√™n ƒë·∫∑t k·∫øt qu·∫£ ·ªü ƒë√¢u. Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, k·∫øt qu·∫£ s·∫Ω n·∫±m trong `rax`.

·ªû c·∫•p ƒë·ªô n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi `ƒëi·ªÅu khi·ªÉn lu·ªìng (control flow manipulation)`. ƒêi·ªÅu n√†y bao g·ªìm vi·ªác s·ª≠ d·ª•ng c√°c l·ªánh ƒë·ªÉ gi√°n ti·∫øp v√† tr·ª±c ti·∫øp ƒëi·ªÅu khi·ªÉn thanh ghi ƒë·∫∑c bi·ªát `rip` (instruction pointer). B·∫°n s·∫Ω s·ª≠ d·ª•ng c√°c l·ªánh nh∆∞ `jmp, call, cmp` v√† c√°c bi·∫øn th·ªÉ c·ªßa ch√∫ng ƒë·ªÉ tri·ªÉn khai h√†nh vi ƒë∆∞·ª£c y√™u c·∫ßu.

Trong m·ªôt c·∫•p tr∆∞·ªõc ƒë√≥, b·∫°n ƒë√£ t√≠nh trung b√¨nh c·ªßa 4 s·ªë nguy√™n (quad words), ƒë√¢y l√† m·ªôt l∆∞·ª£ng c·ªë ƒë·ªãnh ƒë·ªÉ t√≠nh to√°n. Nh∆∞ng l√†m th·∫ø n√†o ƒë·ªÉ x·ª≠ l√Ω v·ªõi nh·ªØng k√≠ch th∆∞·ªõc ƒë∆∞·ª£c cung c·∫•p `khi ch∆∞∆°ng tr√¨nh ƒëang ch·∫°y`?

Trong h·∫ßu h·∫øt c√°c ng√¥n ng·ªØ l·∫≠p tr√¨nh, c√≥ m·ªôt c·∫•u tr√∫c g·ªçi l√† `for-loop`, cho ph√©p b·∫°n th·ª±c thi m·ªôt t·∫≠p h·ª£p l·ªánh trong m·ªôt kho·∫£ng s·ªë l·∫ßn x√°c ƒë·ªãnh. S·ªë l·∫ßn l·∫∑p c√≥ th·ªÉ ƒë√£ ƒë∆∞·ª£c bi·∫øt tr∆∞·ªõc ho·∫∑c ƒë∆∞·ª£c cung c·∫•p ƒë·ªông khi ch∆∞∆°ng tr√¨nh ch·∫°y.

V√≠ d·ª•, m·ªôt v√≤ng l·∫∑p for c√≥ th·ªÉ ƒë∆∞·ª£c d√πng ƒë·ªÉ t√≠nh t·ªïng c√°c s·ªë t·ª´ 1 ƒë·∫øn n:
 
    sum = 0
    i = 1
    while i <= n:
        sum += i
        i += 1

Nhi·ªám v·ª• c·ªßa b√†i:

- H√£y t√≠nh trung b√¨nh c·ªßa n quad words li√™n ti·∫øp, trong ƒë√≥:

    - **rdi** = ƒë·ªãa ch·ªâ b·ªô nh·ªõ c·ªßa quad word ƒë·∫ßu ti√™n  
    - **rsi** = n (s·ªë l∆∞·ª£ng c·∫ßn l·∫∑p)  
    - **rax** = gi√° tr·ªã trung b√¨nh ƒë√£ t√≠nh  

---

#### L·ªùi gi·∫£i:
B√†i n√†y ban ƒë·∫ßu m√¨nh s·∫Ω kh·ªüi t·∫°o gi√° tr·ªã ban ƒë·∫ßu cho `sum` v√† `i` ƒë∆∞·ª£c l∆∞u t∆∞∆°ng ·ª©ng ·ªü `rcx` v√† `rdx`. Sau ƒë√≥ m√¨nh s·∫Ω vi·∫øt 2 label ƒë·ªÉ c√≥ th·ªÉ ho·∫°t ƒë·ªông nh∆∞ v√≤ng l·∫∑p v√† t√≠nh to√°n y√™u c·∫ßu c·ªßa b√†i.

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    mov rcx, [rdi]
    mov rdx, 0x1

    jmp .loop

    .loop:
        cmp rdx, rsi
        jg .endloop

        add rcx, [rdi + rdx * 0x8]
        add rdx, 0x1

        jmp .loop

    .endloop:
        xor rdx, rdx    #rdx:rax / rsi -> clear rdx
        mov rax, rcx
        div rsi

"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{oPkY2SJxYehy1jmf8co-mDyDm40.dNTMywCMxADNwEzW}```

---

### Level 28 - count-non-zero

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

Trong level n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi vi·ªác thao t√°c lu·ªìng ƒëi·ªÅu khi·ªÉn. ƒêi·ªÅu n√†y li√™n quan ƒë·∫øn vi·ªác s·ª≠ d·ª•ng c√°c l·ªánh ƒë·ªÉ gi√°n ti·∫øp v√† tr·ª±c ti·∫øp ƒëi·ªÅu khi·ªÉn thanh ghi ƒë·∫∑c bi·ªát `rip`, t·ª©c con tr·ªè l·ªánh. B·∫°n s·∫Ω s·ª≠ d·ª•ng c√°c l·ªánh nh∆∞ `jmp`, `call`, `cmp`, v√† c√°c bi·∫øn th·ªÉ c·ªßa ch√∫ng ƒë·ªÉ th·ª±c hi·ªán h√†nh vi ƒë∆∞·ª£c y√™u c·∫ßu.

Ch√∫ng t√¥i s·∫Ω ki·ªÉm tra code c·ªßa b·∫°n nhi·ªÅu l·∫ßn trong level n√†y v·ªõi c√°c gi√° tr·ªã ƒë·ªông. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ch√∫ng t√¥i s·∫Ω ch·∫°y code c·ªßa b·∫°n v·ªõi nhi·ªÅu c√°ch ng·∫´u nhi√™n ƒë·ªÉ ki·ªÉm tra xem logic c√≥ ƒë·ªß m·∫°nh ƒë·ªÉ ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh kh√¥ng.

·ªû c√°c level tr∆∞·ªõc, b·∫°n ƒë√£ kh√°m ph√° v√≤ng l·∫∑p `for` ƒë·ªÉ l·∫∑p l·∫°i m·ªôt s·ªë l·∫ßn, c√≥ th·ªÉ l√† ƒë·ªông ho·∫∑c tƒ©nh. Nh∆∞ng n·∫øu b·∫°n mu·ªën l·∫∑p cho ƒë·∫øn khi g·∫∑p m·ªôt ƒëi·ªÅu ki·ªán th√¨ sao?  

C√≥ m·ªôt c·∫•u tr√∫c v√≤ng l·∫∑p th·ª© hai g·ªçi l√† `while-loop` ƒë·ªÉ ƒë√°p ·ª©ng nhu c·∫ßu n√†y. Trong `while-loop`, b·∫°n l·∫∑p l·∫°i cho ƒë·∫øn khi m·ªôt ƒëi·ªÅu ki·ªán ƒë∆∞·ª£c th·ªèa m√£n.

V√≠ d·ª•:

- Gi·∫£ s·ª≠ ch√∫ng ta c√≥ m·ªôt v√πng nh·ªõ v·ªõi c√°c s·ªë li·ªÅn k·ªÅ v√† ch√∫ng ta mu·ªën l·∫•y trung b√¨nh c·ªßa t·∫•t c·∫£ c√°c s·ªë cho ƒë·∫øn khi g·∫∑p m·ªôt s·ªë l·ªõn h∆°n ho·∫∑c b·∫±ng `0xff`:

        average = 0
        i = 0
        while x[i] < 0xff:
            average += x[i]
            i += 1
        average /= i

D·ª±a tr√™n ki·∫øn th·ª©c tr√™n, h√£y th·ª±c hi·ªán nh∆∞ sau:

ƒê·∫øm s·ªë byte li√™n ti·∫øp kh√°c 0 trong m·ªôt v√πng nh·ªõ li√™n t·ª•c, v·ªõi:
- `rdi` = ƒë·ªãa ch·ªâ √¥ nh·ªõ c·ªßa byte ƒë·∫ßu ti√™n
- `rax` = s·ªë byte li√™n ti·∫øp kh√°c 0

Ngo√†i ra, n·∫øu rdi = 0 th√¨ set rax = 0 (ch√∫ng t√¥i s·∫Ω ki·ªÉm tra ƒëi·ªÅu n√†y)!

V√† v√≠ d·ª• c√≥ 1 testcase nh∆∞ sau:

- `rdi = 0x1000`
- `[0x1000] = 0x41`
- `[0x1001] = 0x42`
- `[0x1002] = 0x43`
- `[0x1003] = 0x00`

Sau ƒë√≥: `rax = 3` s·∫Ω ƒë∆∞·ª£c set

---

#### L·ªùi gi·∫£i:
B√†i n√†y ban ƒë·∫ßu m√¨nh s·∫Ω kh·ªüi t·∫°o gi√° tr·ªã ban ƒë·∫ßu cho bi·∫øn ƒë·∫øm (`rax`). Sau ƒë√≥ m√¨nh s·∫Ω vi·∫øt 2 label ƒë·ªÉ c√≥ th·ªÉ ho·∫°t ƒë·ªông nh∆∞ v√≤ng l·∫∑p whole v√† t√≠nh to√°n y√™u c·∫ßu c·ªßa b√†i. Nh∆∞ng ph·∫£i l∆∞u √Ω ban ƒë·∫ßu s·∫Ω c√≥ tr∆∞·ªùng h·ª£p gi√° tr·ªã c·ªßa rdi s·∫Ω l√† 0 v√† n·∫øu ta truy c·∫≠p v√†o ƒë·ªãa ch·ªâ ƒë√≥ th√¨ s·∫Ω b·ªã l·ªói. N√™n ph·∫£i x·ª≠ l√≠ tr∆∞·ªõc tr∆∞·ªùng h·ª£p n√†y.

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    cmp rdi, 0
    je .endloop
    xor rax, rax

    jmp .loop

    .loop:
        cmp byte ptr [rdi + rax], 0x00
        je .endloop

        add rax, 0x1

        jmp .loop

    .endloop:
        nop

"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{swPCOpn83vVmA_T-MkWFTwMqV25.dRTMywCMxADNwEzW}```

---

### Level 29 - string-lower

---

### T√≥m t·∫Øt ƒë·ªÅ b√†i

Ch√∫ng t√¥i s·∫Ω ki·ªÉm tra code c·ªßa b·∫°n nhi·ªÅu l·∫ßn trong level n√†y v·ªõi c√°c gi√° tr·ªã ƒë·ªông!  
ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† code c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c ch·∫°y trong nhi·ªÅu t√¨nh hu·ªëng ng·∫´u nhi√™n ƒë·ªÉ x√°c minh r·∫±ng logic ƒë·ªß m·∫°nh ƒë·ªÉ ho·∫°t ƒë·ªông ƒë√∫ng trong qu√° tr√¨nh s·ª≠ d·ª•ng b√¨nh th∆∞·ªùng.  

Trong level n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi `h√†m (function)`!  
ƒêi·ªÅu n√†y s·∫Ω bao g·ªìm vi·ªác thao t√°c v·ªõi **instruction pointer (rip)**, c≈©ng nh∆∞ th·ª±c hi·ªán c√°c t√°c v·ª• kh√≥ h∆°n b√¨nh th∆∞·ªùng.  
B·∫°n c√≥ th·ªÉ s·∫Ω c·∫ßn d√πng stack ƒë·ªÉ l∆∞u tr·ªØ gi√° tr·ªã ho·∫∑c g·ªçi c√°c h√†m m√† ch√∫ng t√¥i cung c·∫•p cho b·∫°n.  

·ªû c√°c level tr∆∞·ªõc, b·∫°n ƒë√£ tri·ªÉn khai m·ªôt v√≤ng l·∫∑p `while` ƒë·ªÉ ƒë·∫øm s·ªë byte li√™n ti·∫øp kh√°c 0 trong m·ªôt v√πng nh·ªõ li√™n t·ª•c.  

Trong level n√†y, b·∫°n s·∫Ω l·∫°i ƒë∆∞·ª£c cung c·∫•p m·ªôt v√πng nh·ªõ li√™n t·ª•c v√† s·∫Ω l·∫∑p qua t·ª´ng byte, th·ª±c hi·ªán m·ªôt ph√©p to√°n c√≥ ƒëi·ªÅu ki·ªán cho ƒë·∫øn khi g·∫∑p byte b·∫±ng 0.  
T·∫•t c·∫£ s·∫Ω n·∫±m trong `m·ªôt h√†m`!  

M·ªôt **h√†m** l√† m·ªôt ƒëo·∫°n m√£ c√≥ th·ªÉ g·ªçi ƒë∆∞·ª£c m√† kh√¥ng ph√° v·ª° lu·ªìng ƒëi·ªÅu khi·ªÉn.  

C√°c h√†m s·ª≠ d·ª•ng l·ªánh **`call`** v√† **`ret`**.  

- **`call`** ƒë·∫©y ƒë·ªãa ch·ªâ c·ªßa l·ªánh k·∫ø ti·∫øp l√™n stack, sau ƒë√≥ nh·∫£y t·ªõi gi√° tr·ªã ƒë∆∞·ª£c l∆∞u trong to√°n h·∫°ng.  
- **`ret`** th√¨ ng∆∞·ª£c l·∫°i: n√≥ l·∫•y gi√° tr·ªã tr√™n ƒë·ªânh stack v√† nh·∫£y t·ªõi ƒë·ªãa ch·ªâ ƒë√≥.  

V√≠ d·ª• v·ªõi `call`:

    0x1021 mov rax, 0x400000
    0x1028 call rax
    0x102a mov [rsi], rax

- call ƒë·∫©y 0x102a (ƒë·ªãa ch·ªâ c·ªßa l·ªánh k·∫ø ti·∫øp) l√™n stack.
- call nh·∫£y t·ªõi 0x400000 (gi√° tr·ªã trong rax).

V√≠ d·ª• v·ªõi `ret`:

                            Stack ADDR  VALUE
    0x103f mov rax, rdx         RSP + 0x8   0xdeadbeef
    0x1042 ret                  RSP + 0x0   0x0000102a
    
- ·ªû ƒë√¢y, ret s·∫Ω nh·∫£y t·ªõi 0x102a

Nhi·ªám v·ª• c·ªßa b√†i:

    str_lower(src_addr):
    i = 0
    if src_addr != 0:
        while [src_addr] != 0x00:
        if [src_addr] <= 0x5a:
            [src_addr] = foo([src_addr])
            i += 1
        src_addr += 1
    return i


- foo ƒë∆∞·ª£c cung c·∫•p t·∫°i ƒë·ªãa ch·ªâ 0x403000.
- foo nh·∫≠n m·ªôt byte l√†m tham s·ªë v√† tr·∫£ v·ªÅ m·ªôt byte.

Quy ∆∞·ªõc g·ªçi h√†m:

T·∫•t c·∫£ c√°c h√†m (foo v√† str_lower) ph·∫£i tu√¢n th·ªß Linux amd64 calling convention (hay System V AMD64 ABI):

- H√†m str_lower nh·∫≠n src_addr trong rdi.
- H√†m ph·∫£i tr·∫£ k·∫øt qu·∫£ trong rax.

L∆∞u √Ω:

- src_addr l√† m·ªôt ƒë·ªãa ch·ªâ trong b·ªô nh·ªõ (n∆°i string ƒë∆∞·ª£c l∆∞u).

- [src_addr] l√† byte t·∫°i ƒë·ªãa ch·ªâ ƒë√≥.

V√¨ v·∫≠y:

- foo nh·∫≠n m·ªôt byte (gi√° tr·ªã) l√†m tham s·ªë ƒë·∫ßu ti√™n.
- foo tr·∫£ v·ªÅ m·ªôt byte

---

#### L·ªùi gi·∫£i

T∆∞∆°ng t·ª± nh∆∞ nh·ªØng b√†i tr√™n, b√†i n√†y m√¨nh s·∫Ω t·∫°o ra nh·ªØng label t∆∞∆°ng ·ª©ng ƒë·ªÉ s·ª≠ d·ª•ng ho·∫°t ƒë·ªông nh∆∞ v√≤ng l·∫∑p.

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    xor rax, rax
    cmp rdi, 0
    je .return

    .loop:
        cmp byte ptr [rdi], 0x00
        je .endloop

        cmp byte ptr [rdi], 0x5a
        jg .case2

        jmp .case1


    .case1:
        mov rbx, [rdi]
        push rdi                 
        push rax                 
        mov rdi, 0
        mov dil, bl              
        mov r10, 0x403000
        call r10                 
        mov bl, al               
        pop rax                  
        pop rdi                  
        mov [rdi], bl            
        add rax, 1
        add rdi, 0x1  
        jmp .loop

    .case2:
        add rdi, 0x1
        jmp .loop


    .endloop:
        jmp .return

    .return:
        ret
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{YdmHF_YqEjOkq2hyS51T56fgyhA.dVTMywCMxADNwEzW}```

---

### Level 30 - most-common-byte

---

#### T√≥m t·∫Øt ƒë·ªÅ b√†i

Ch√∫ng t√¥i s·∫Ω ki·ªÉm tra code c·ªßa b·∫°n nhi·ªÅu l·∫ßn trong level n√†y v·ªõi **gi√° tr·ªã ƒë·ªông**!  

ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† ch√∫ng t√¥i s·∫Ω ch·∫°y code c·ªßa b·∫°n theo nhi·ªÅu c√°ch ng·∫´u nhi√™n kh√°c nhau ƒë·ªÉ x√°c minh r·∫±ng logic ƒë·ªß m·∫°nh m·∫Ω ƒë·ªÉ ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh trong qu√° tr√¨nh s·ª≠ d·ª•ng b√¨nh th∆∞·ªùng.  

Trong level n√†y, b·∫°n s·∫Ω l√†m vi·ªác v·ªõi **h√†m (functions)**!  
ƒêi·ªÅu n√†y s·∫Ω li√™n quan ƒë·∫øn vi·ªác thao t√°c v·ªõi **instruction pointer (`rip`)**, c≈©ng nh∆∞ th·ª±c hi·ªán c√°c t√°c v·ª• kh√≥ h∆°n b√¨nh th∆∞·ªùng. B·∫°n c√≥ th·ªÉ s·∫Ω ƒë∆∞·ª£c y√™u c·∫ßu s·ª≠ d·ª•ng stack ƒë·ªÉ l∆∞u tr·ªØ gi√° tr·ªã ho·∫∑c g·ªçi c√°c h√†m m√† ch√∫ng t√¥i cung c·∫•p cho b·∫°n.  

·ªû level tr∆∞·ªõc, b·∫°n ƒë√£ h·ªçc c√°ch t·∫°o h√†m ƒë·∫ßu ti√™n v√† c√°ch g·ªçi c√°c h√†m kh√°c.  
B√¢y gi·ªù, ch√∫ng ta s·∫Ω l√†m vi·ªác v·ªõi c√°c h√†m c√≥ **function stack frame**.  

M·ªôt **function stack frame** l√† m·ªôt t·∫≠p h·ª£p c√°c con tr·ªè v√† gi√° tr·ªã ƒë∆∞·ª£c push v√†o stack ƒë·ªÉ l∆∞u l·∫°i cho vi·ªác s·ª≠ d·ª•ng sau n√†y v√† c·∫•p ph√°t kh√¥ng gian tr√™n stack cho c√°c bi·∫øn c·ªßa h√†m.  

Thanh ghi `rbp`
- `rbp` c√≤n g·ªçi l√† **Stack Base Pointer**.  
- D√πng ƒë·ªÉ x√°c ƒë·ªãnh n∆°i m√† stack frame c·ªßa ch√∫ng ta b·∫Øt ƒë·∫ßu.  

V√≠ d·ª•, n·∫øu ta mu·ªën t·∫°o m·ªôt danh s√°ch c√≥ 5 ph·∫ßn t·ª≠ (m·ªói ph·∫ßn t·ª≠ l√† `dword`) ch·ªâ d√πng trong h√†m:  

    ; thi·∫øt l·∫≠p base c·ªßa stack b·∫±ng top hi·ªán t·∫°i
    mov rbp, rsp
    ; d·ªãch stack xu·ªëng 0x14 byte (5 * 4)
    ; h√†nh ƒë·ªông nh∆∞ c·∫•p ph√°t b·ªô nh·ªõ
    sub rsp, 0x14
    ; g√°n list[2] = 1337
    mov eax, 1337
    mov [rbp-0xc], eax
    ; th·ª±c hi·ªán th√™m c√°c thao t√°c kh√°c tr√™n list ...
    ; kh√¥i ph·ª•c l·∫°i kh√¥ng gian ƒë√£ c·∫•p ph√°t
    mov rsp, rbp

- rbp lu√¥n ƒë∆∞·ª£c d√πng ƒë·ªÉ kh√¥i ph·ª•c stack v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu.
- N·∫øu kh√¥ng kh√¥i ph·ª•c stack ‚Üí cu·ªëi c√πng s·∫Ω b·ªã ƒë·∫ßy.
- Ch√∫ng ta tr·ª´ t·ª´ rsp v√¨ stack ph√°t tri·ªÉn h∆∞·ªõng xu·ªëng.
- Khi g√°n list[2], ta tr·ª´ ƒëi 12 byte (3 dwords) v√¨ stack tƒÉng ng∆∞·ª£c.

Nhi·ªám v·ª• c·ªßa b√†i:

    most_common_byte(src_addr, size):
    i = 0
    while i <= size-1:
        curr_byte = [src_addr + i]
        [stack_base - curr_byte * 2] += 1
        i += 1

    b = 0
    max_freq = 0
    max_freq_byte = 0
    while b <= 0xff:
        if [stack_base - b * 2] > max_freq:
        max_freq = [stack_base - b * 2]
        max_freq_byte = b
        b += 1

    return max_freq_byte

Gi·∫£ ƒë·ªãnh (Assumptions)

- S·∫Ω kh√¥ng bao gi·ªù c√≥ nhi·ªÅu h∆°n 0xffff c·ªßa b·∫•t k·ª≥ byte n√†o

- K√≠ch th∆∞·ªõc (size) s·∫Ω kh√¥ng bao gi·ªù d√†i h∆°n 0xffff

- Danh s√°ch lu√¥n c√≥ √≠t nh·∫•t m·ªôt ph·∫ßn t·ª≠

R√†ng bu·ªôc (Constraints)

- B·∫°n ph·∫£i ƒë·∫∑t "counting list" tr√™n stack

- B·∫°n ph·∫£i kh√¥i ph·ª•c stack nh∆∞ m·ªôt h√†m b√¨nh th∆∞·ªùng

- B·∫°n kh√¥ng ƒë∆∞·ª£c ph√©p thay ƒë·ªïi d·ªØ li·ªáu t·∫°i src_addr

---

### L·ªùi gi·∫£i

T∆∞∆°ng t·ª± nh∆∞ nh·ªØng b√†i tr√™n, b√†i n√†y m√¨nh s·∫Ω t·∫°o ra nh·ªØng label t∆∞∆°ng ·ª©ng ƒë·ªÉ s·ª≠ d·ª•ng ho·∫°t ƒë·ªông nh∆∞ v√≤ng l·∫∑p.

```python
import pwn

pwn.context.update(arch="amd64")
output = pwn.process("/challenge/run")

asm = """
    

    .return:
        ret
"""

output.write(pwn.asm(asm))
print(output.readallS())
```

---

#### Flag
```pwn.college{YdmHF_YqEjOkq2hyS51T56fgyhA.dVTMywCMxADNwEzW}```

---